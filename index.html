<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Spot Finder - Boulder Restaurants & Breweries</title>
  <meta name="description" content="Browse and filter 145+ restaurants, breweries, and bars in the Boulder, CO area." />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìç</text></svg>" />

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React + ReactDOM CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Babel for JSX in-browser -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- SheetJS for spreadsheet export -->
  <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>

  <!-- Firebase SDKs (compat mode for CDN usage) -->
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth-compat.js"></script>

  <!-- Google Maps + Places API (configure key in GOOGLE-PLACES-SETUP-GUIDE.md) -->
  <script>
    window.GOOGLE_MAPS_KEY = "AIzaSyBe4eERGerFFgaVJY1jRHaCB9C6I9fFVek";
    window.GOOGLE_MAPS_READY = window.GOOGLE_MAPS_KEY !== "YOUR_GOOGLE_MAPS_KEY";
  </script>
  <script>
    if (window.GOOGLE_MAPS_READY) {
      var s = document.createElement("script");
      s.src = "https://maps.googleapis.com/maps/api/js?key=" + window.GOOGLE_MAPS_KEY + "&libraries=places";
      s.async = true;
      document.head.appendChild(s);
    }
  </script>

  <style>
    /* Prevent FOUC while Babel compiles */
    #root { min-height: 100vh; }
    /* Prevent iOS Safari zoom on input focus ‚Äî must be 16px+ */
    input, select, textarea { font-size: 16px !important; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
const { useState, useMemo, useRef, useEffect, useCallback } = React;

// ===== FIREBASE CONFIG =====
// PASTE YOUR FIREBASE CONFIG HERE (see FIREBASE-SETUP-GUIDE.md Step 6)
const firebaseConfig = {
  apiKey: "AIzaSyBaSq6PG8j15wKj5OKrmJC5g8_x3pp8Joo",
  authDomain: "restaurant-finder-13c18.firebaseapp.com",
  projectId: "restaurant-finder-13c18",
  storageBucket: "restaurant-finder-13c18.firebasestorage.app",
  messagingSenderId: "390270735577",
  appId: "1:390270735577:web:66eaf633f301a338955ac8"
};

// Initialize Firebase (only if config is set up)
const FIREBASE_READY = firebaseConfig.apiKey !== "YOUR_API_KEY_HERE";
let db = null;
let auth = null;
if (FIREBASE_READY) {
  firebase.initializeApp(firebaseConfig);
  db = firebase.firestore();
  auth = firebase.auth();
}

const PLACES = [
  { id: 1, name: "24 Carrot", location: "Erie", type: "Restaurant", foodType: "New American", kidFriendly: "maybe", vibe: "Upscale farm-to-table bistro", goodFor: "Lunch, brunch, date night", happyHour: false, dinner: true, lunch: true, brunch: true, outdoor: true, notableOutdoor: true, notes: "" },
  { id: 2, name: "4 Noses Brewing", location: "Broomfield", type: "Brewery", foodType: "Brewery", kidFriendly: "maybe", vibe: "Family-owned brewery, casual taproom", goodFor: "Beer lovers, casual hangout", happyHour: true, dinner: false, lunch: false, brunch: false, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 3, name: "Acreage", location: "Erie", type: "Brewery & Restaurant", foodType: "American", kidFriendly: "yes", vibe: "Modern cider house with scenic views", goodFor: "Family outings, groups, scenic dining", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: true, notableOutdoor: true, notes: "" },
  { id: 4, name: "Aloy Thai", location: "Boulder", type: "Restaurant", foodType: "Thai", kidFriendly: "maybe", vibe: "Casual Thai restaurant", goodFor: "Lunch, affordable meals", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 5, name: "Amu", location: "Boulder", type: "Restaurant", foodType: "Asian", kidFriendly: "no", vibe: "Intimate Japanese izakaya, sake-focused", goodFor: "Date night, intimate dining", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 6, name: "Asher Brewing", location: "Gunbarrel", type: "Brewery", foodType: "Brewery", kidFriendly: "maybe", vibe: "Organic brewery, casual taproom", goodFor: "Beer lovers, casual games", happyHour: false, dinner: false, lunch: false, brunch: false, outdoor: true, notableOutdoor: false, notes: "" },
  { id: 7, name: "Audrey Jane's Pizza Garage", location: "Boulder", type: "Restaurant", foodType: "Pizza", kidFriendly: "yes", vibe: "Neighborhood pizza shop, casual", goodFor: "Pizza, casual family dining", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 8, name: "Avanti", location: "Boulder", type: "Food Hall", foodType: "Multi-vendor", kidFriendly: "yes", vibe: "Modern food hall with multiple concepts", goodFor: "Quick lunch, variety seekers, groups", happyHour: true, dinner: true, lunch: true, brunch: false, outdoor: true, notableOutdoor: false, notes: "" },
  { id: 9, name: "Avery", location: "Gunbarrel", type: "Brewery & Restaurant", foodType: "American", kidFriendly: "yes", vibe: "Dog-friendly brewery and restaurant", goodFor: "Beer lovers, families, casual", happyHour: true, dinner: true, lunch: true, brunch: false, outdoor: true, notableOutdoor: true, notes: "" },
  { id: 10, name: "BJ's", location: "Boulder", type: "Restaurant", foodType: "Pizza", kidFriendly: "yes", vibe: "Family-friendly brewhouse, casual", goodFor: "Pizza, families, casual dining", happyHour: true, dinner: true, lunch: true, brunch: false, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 11, name: "Backcountry Pizza", location: "Boulder", type: "Restaurant", foodType: "American", kidFriendly: "yes", vibe: "Casual & beer focused, Pub", goodFor: "Pizza, casual games, families", happyHour: true, dinner: true, lunch: false, brunch: false, outdoor: true, notableOutdoor: false, notes: "*not open Mon or Tues*, happy hour until 6 on sunday (?) with half prized appetizers!!" },
  { id: 12, name: "BarTaco", location: "Boulder", type: "Restaurant", foodType: "Mexican", kidFriendly: "maybe", vibe: "upscale trendy mexican", goodFor: "Tacos, margaritas, happy hour", happyHour: true, dinner: true, lunch: true, brunch: false, outdoor: true, notableOutdoor: false, notes: "quite popular, tasty, not that cheap" },
  { id: 13, name: "Barchetta", location: "Boulder", type: "Restaurant", foodType: "Pizza", kidFriendly: "yes", vibe: "Upscale and Casual at same time", goodFor: "Family dinners", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: true, notableOutdoor: false, notes: "" },
  { id: 14, name: "Basta", location: "Boulder", type: "Restaurant", foodType: "Italian", kidFriendly: "no", vibe: "Upscale wood-fired Italian", goodFor: "Special occasions, date night", happyHour: false, dinner: true, lunch: false, brunch: false, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 15, name: "Bellota", location: "Boulder", type: "Restaurant", foodType: "Mexican", kidFriendly: "maybe", vibe: "Upscale authentic Mexican with patio", goodFor: "Dinner, date night", happyHour: false, dinner: true, lunch: false, brunch: false, outdoor: true, notableOutdoor: false, notes: "" },
  { id: 16, name: "Birdhouse", location: "Erie", type: "Restaurant", foodType: "Asian", kidFriendly: "maybe", vibe: "Fusion", goodFor: "Ramen, quick lunch, Asian fusion", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 17, name: "Bitter Bar", location: "Boulder", type: "Bar", foodType: "Bar", kidFriendly: "no", vibe: "Cocktail bar", goodFor: "Cocktails, date night", happyHour: false, dinner: false, lunch: false, brunch: false, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 18, name: "Blackbelly", location: "Boulder", type: "Restaurant", foodType: "American", kidFriendly: "no", vibe: "Butcher shop", goodFor: "Special occasions, fine dining", happyHour: false, dinner: false, lunch: true, brunch: false, outdoor: false, notableOutdoor: false, notes: "too expensive for what it is for dinner" },
  { id: 19, name: "Bohemian Biergarten", location: "Boulder", type: "Brewery & Restaurant", foodType: "German", kidFriendly: "maybe", vibe: "Authentic German beer garden, historic building", goodFor: "Beer lovers, families, groups", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: true, notableOutdoor: true, notes: "" },
  { id: 20, name: "Boss Lady Pizza", location: "Boulder", type: "Takeout", foodType: "Pizza", kidFriendly: "maybe", vibe: "Casual pizza takeout", goodFor: "Quick pizza", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 21, name: "Boulder Cork", location: "Boulder", type: "Restaurant", foodType: "American", kidFriendly: "no", vibe: "Steakhouse", goodFor: "Special occasions, steak dinners", happyHour: false, dinner: true, lunch: false, brunch: false, outdoor: true, notableOutdoor: false, notes: "" },
  { id: 22, name: "Boulder Social", location: "Boulder", type: "Restaurant", foodType: "American", kidFriendly: "yes", vibe: "Brewery, restaurant, and social hangout", goodFor: "Families, beer lovers, brunch", happyHour: false, dinner: true, lunch: true, brunch: true, outdoor: true, notableOutdoor: true, notes: "" },
  { id: 23, name: "Bramble and Hare", location: "Boulder", type: "Restaurant", foodType: "New American", kidFriendly: "no", vibe: "Upscale farm-to-table farmhouse", goodFor: "Special occasions, farm-to-table", happyHour: false, dinner: true, lunch: false, brunch: false, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 24, name: "Brasserie 10 10", location: "Boulder", type: "Restaurant", foodType: "French", kidFriendly: "maybe", vibe: "Parisian-style bistro", goodFor: "French cuisine, date night, brunch", happyHour: false, dinner: true, lunch: true, brunch: true, outdoor: true, notableOutdoor: false, notes: "" },
  { id: 25, name: "Buff", location: "Boulder", type: "Restaurant", foodType: "Brunch/Cafe", kidFriendly: "yes", vibe: "Casual breakfast and brunch spot", goodFor: "Breakfast, brunch, casual family meal", happyHour: false, dinner: false, lunch: true, brunch: true, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 26, name: "Busaba Thai", location: "Boulder", type: "Takeout", foodType: "Thai", kidFriendly: "maybe", vibe: "Casual Thai takeout", goodFor: "Quick Thai lunch", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 27, name: "Busaba Thai Louisville", location: "Louisville", type: "Restaurant", foodType: "Thai", kidFriendly: "maybe", vibe: "Casual Thai restaurant with patio", goodFor: "Thai dinner, casual family dining", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: true, notableOutdoor: false, notes: "" },
  { id: 28, name: "Cafe Aion", location: "Boulder", type: "Restaurant", foodType: "Tapas", kidFriendly: "maybe", vibe: "Spanish", goodFor: "Tapas, paella, happy hour", happyHour: true, dinner: true, lunch: true, brunch: true, outdoor: true, notableOutdoor: false, notes: "Good Bloody Marys" },
  { id: 29, name: "Cellar West Artisan Ales", location: "Lafayette", type: "Brewery", foodType: "Brewery", kidFriendly: "maybe", vibe: "Small-batch brewery with events", goodFor: "Beer lovers, live music, events", happyHour: false, dinner: false, lunch: false, brunch: false, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 30, name: "Centro", location: "Boulder", type: "Restaurant", foodType: "Mexican", kidFriendly: "yes", vibe: "Trendy casual", goodFor: "Mexican cuisine, happy hour, groups", happyHour: true, dinner: true, lunch: true, brunch: true, outdoor: true, notableOutdoor: false, notes: "atmosphere is great, food is ok, but isn't super cheap" },
  { id: 31, name: "Chatauqua Dining Hall", location: "Boulder", type: "Restaurant", foodType: "New American", kidFriendly: "yes", vibe: "Historic Victorian with wrap-around porch", goodFor: "Families, scenic views, brunch", happyHour: true, dinner: true, lunch: true, brunch: true, outdoor: true, notableOutdoor: true, notes: "" },
  { id: 32, name: "Colorado Tap House", location: "Arvada", type: "Brewery", foodType: "Brewery", kidFriendly: "maybe", vibe: "Family-friendly brewery with outdoor games", goodFor: "Families, beer lovers, outdoor activities", happyHour: false, dinner: false, lunch: false, brunch: false, outdoor: true, notableOutdoor: true, notes: "" },
  { id: 33, name: "Community", location: "Lafayette", type: "Restaurant", foodType: "New American", kidFriendly: "yes", vibe: "Small plates", goodFor: "Families, handmade pasta, casual dinner", happyHour: true, dinner: true, lunch: false, brunch: false, outdoor: true, notableOutdoor: false, notes: "Super cute, delicious food, not cheap but not expensive, often a long wait" },
  { id: 34, name: "Corner Bar at Boulderado", location: "Boulder", type: "Bar & Restaurant", foodType: "American", kidFriendly: "yes", vibe: "Casual burger bar in historic hotel", goodFor: "happy hour, date night", happyHour: true, dinner: true, lunch: true, brunch: false, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 35, name: "Corrida", location: "Boulder", type: "Restaurant", foodType: "Tapas", kidFriendly: "no", vibe: "Spanish", goodFor: "Special occasions, steak, rooftop views", happyHour: true, dinner: true, lunch: false, brunch: true, outdoor: true, notableOutdoor: true, notes: "" },
  { id: 36, name: "Cultivate Kitchen", location: "Louisville", type: "Takeout", foodType: "Brunch/Cafe", kidFriendly: "maybe", vibe: "Healthy meal prep", goodFor: "Meal prep, healthy eating", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 37, name: "Dagabi Tapas", location: "Boulder", type: "Restaurant", foodType: "Tapas", kidFriendly: "maybe", vibe: "Hidden Spanish tapas bar", goodFor: "Spanish tapas, wood-fired pizza", happyHour: true, dinner: true, lunch: true, brunch: false, outdoor: true, notableOutdoor: false, notes: "" },
  { id: 38, name: "Dark Horse", location: "Boulder", type: "Bar & Restaurant", foodType: "American", kidFriendly: "maybe", vibe: "Iconic kitschy bar with antiques and burgers", goodFor: "Burgers, casual hangout, karaoke", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 39, name: "Dragonfly", location: "Boulder", type: "Restaurant", foodType: "Asian", kidFriendly: "maybe", vibe: "Fusion", goodFor: "Ramen, Asian fusion", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 40, name: "Dushanbe Tea House", location: "Boulder", type: "Restaurant", foodType: "Brunch/Cafe", kidFriendly: "yes", vibe: "Tea house, global cuisine", goodFor: "", happyHour: false, dinner: true, lunch: true, brunch: true, outdoor: true, notableOutdoor: false, notes: "" },
  { id: 41, name: "Efrains", location: "Boulder", type: "Restaurant", foodType: "Mexican", kidFriendly: "yes", vibe: "Classic mexican restaurant boulder style", goodFor: "", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: false, notableOutdoor: false, notes: "Delicious classic tex mex food, quite popular" },
  { id: 42, name: "Flower Child", location: "Boulder", type: "Restaurant", foodType: "Brunch/Cafe", kidFriendly: "yes", vibe: "Healthy, salads", goodFor: "Quick healthy lunch, dietary restrictions", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: true, notableOutdoor: false, notes: "" },
  { id: 43, name: "Folsom Thai", location: "Boulder", type: "Restaurant", foodType: "Thai", kidFriendly: "maybe", vibe: "Cozy neighborhood Thai restaurant", goodFor: "Thai lunch, casual dining", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 44, name: "Foolish Craigs", location: "Boulder", type: "Restaurant", foodType: "Brunch/Cafe", kidFriendly: "yes", vibe: "Casual brunch and breakfast cafe", goodFor: "Breakfast, brunch, casual family meals", happyHour: false, dinner: false, lunch: true, brunch: true, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 45, name: "Fortezza", location: "Niwot", type: "Restaurant", foodType: "Italian", kidFriendly: "no", vibe: "Upscale Northern Italian steakhouse", goodFor: "Special occasions, fine dining", happyHour: false, dinner: true, lunch: true, brunch: true, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 46, name: "Fringe Pizza", location: "Boulder", type: "Restaurant", foodType: "Pizza", kidFriendly: "maybe", vibe: "Casual Neapolitan pizza with self-pour wine wall", goodFor: "Pizza, casual dining", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: true, notableOutdoor: false, notes: "" },
  { id: 47, name: "Fritz Family Brewers", location: "Niwot", type: "Brewery", foodType: "Brewery", kidFriendly: "maybe", vibe: "Family-friendly craft brewery", goodFor: "Beer lovers, casual hangout", happyHour: false, dinner: false, lunch: false, brunch: false, outdoor: true, notableOutdoor: false, notes: "" },
  { id: 48, name: "Gemini", location: "Boulder", type: "Restaurant", foodType: "Tapas", kidFriendly: "no", vibe: "Contemporary Spanish tapas restaurant", goodFor: "Tapas, wine, date night", happyHour: false, dinner: true, lunch: false, brunch: true, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 49, name: "Gondolier", location: "Boulder", type: "Restaurant", foodType: "Italian", kidFriendly: "yes", vibe: "Family-friendly neighborhood Italian", goodFor: "Italian, pizza, families", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 50, name: "Greenbriar Inn", location: "Lyons", type: "Restaurant", foodType: "American", kidFriendly: "no", vibe: "Elegant upscale restaurant on 20 acres", goodFor: "Special occasions, fine dining, events", happyHour: false, dinner: true, lunch: false, brunch: true, outdoor: true, notableOutdoor: true, notes: "" },
  { id: 51, name: "Grossen Bart", location: "Longmont", type: "Brewery", foodType: "Brewery", kidFriendly: "yes", vibe: "Casual neighborhood brewery with live music", goodFor: "Casual drinks, family gatherings", happyHour: true, dinner: true, lunch: false, brunch: false, outdoor: true, notableOutdoor: false, notes: "" },
  { id: 52, name: "Hapa Sushi", location: "Boulder", type: "Restaurant", foodType: "Japanese", kidFriendly: "maybe", vibe: "Modern Asian fusion with spacious patio", goodFor: "Date night, sushi and sake", happyHour: true, dinner: true, lunch: true, brunch: false, outdoor: true, notableOutdoor: true, notes: "" },
  { id: 53, name: "Il Pastaio", location: "Boulder", type: "Restaurant", foodType: "Italian", kidFriendly: "no", vibe: "Cozy, Casual, charming", goodFor: "", happyHour: false, dinner: true, lunch: false, brunch: false, outdoor: false, notableOutdoor: false, notes: "only open on weeknights, reservations strongly advised mid-late week, very small and intimate" },
  { id: 54, name: "Ironwood Bar and Grill", location: "Boulder", type: "Restaurant", foodType: "American", kidFriendly: "maybe", vibe: "Upscale golf course casual with mountain views", goodFor: "Special occasions, scenic dining", happyHour: true, dinner: true, lunch: true, brunch: false, outdoor: true, notableOutdoor: true, notes: "" },
  { id: 55, name: "Japango", location: "Boulder", type: "Restaurant", foodType: "Japanese", kidFriendly: "maybe", vibe: "Contemporary Japanese in historic Pearl Street building", goodFor: "Date night, Japanese whiskey", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: true, notableOutdoor: false, notes: "" },
  { id: 56, name: "Jax", location: "Boulder", type: "Restaurant", foodType: "Seafood", kidFriendly: "no", vibe: "High-energy East Coast seafood", goodFor: "Special occasion, oysters and seafood", happyHour: true, dinner: true, lunch: false, brunch: false, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 57, name: "Jeannot's Patisserie", location: "Lafayette", type: "Restaurant", foodType: "French", kidFriendly: "yes", vibe: "Bakery", goodFor: "Breakfast, pastries, French classics", happyHour: false, dinner: false, lunch: true, brunch: true, outdoor: true, notableOutdoor: false, notes: "" },
  { id: 58, name: "Jefe's", location: "Longmont", type: "Restaurant", foodType: "Mexican", kidFriendly: "yes", vibe: "Modern taco bar with vibrant murals", goodFor: "Casual lunch, tacos and tequila", happyHour: true, dinner: true, lunch: true, brunch: false, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 59, name: "Jet's Pizza", location: "Boulder", type: "Takeout", foodType: "Pizza", kidFriendly: "yes", vibe: "Detroit-style pizza takeout", goodFor: "Quick pizza pickup", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 60, name: "Jill's at St Julian", location: "Boulder", type: "Restaurant", foodType: "New American", kidFriendly: "maybe", vibe: "Upscale modern bistro, farm-to-table", goodFor: "Special occasion, brunch", happyHour: false, dinner: true, lunch: true, brunch: true, outdoor: true, notableOutdoor: false, notes: "" },
  { id: 61, name: "Jungle", location: "Boulder", type: "Bar & Restaurant", foodType: "Burgers", kidFriendly: "no", vibe: "trendy tiki theme, Tiki bar", goodFor: "Cocktails, casual burgers, happy hour", happyHour: true, dinner: true, lunch: false, brunch: false, outdoor: true, notableOutdoor: false, notes: "Great chicken sandwiches and super fun drinks in awesome glassware, such cool vibes!" },
  { id: 62, name: "Junkyard Social", location: "Boulder", type: "Brewery", foodType: "Brewery", kidFriendly: "yes", vibe: "Community space with art and adventure playground", goodFor: "Family hangout, kids activities", happyHour: false, dinner: false, lunch: true, brunch: false, outdoor: true, notableOutdoor: true, notes: "" },
  { id: 63, name: "Kalita Grill Greek Cafe", location: "Boulder", type: "Takeout", foodType: "Mediterranean", kidFriendly: "yes", vibe: "Greek", goodFor: "Quick lunch, Greek Mediterranean", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 64, name: "Kismet Cafe", location: "Lafayette", type: "", foodType: "Mediterranean", kidFriendly: "yes", vibe: "Mediterranean craft coffee shop", goodFor: "Coffee, breakfast, Turkish flavors", happyHour: false, dinner: false, lunch: true, brunch: true, outdoor: true, notableOutdoor: false, notes: "" },
  { id: 65, name: "Kitchen", location: "Boulder", type: "Restaurant", foodType: "New American", kidFriendly: "maybe", vibe: "Casual-elegant with globally-inspired shared plates", goodFor: "Date night, creative cocktails", happyHour: true, dinner: true, lunch: true, brunch: true, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 66, name: "Kitchen Upstairs", location: "Boulder", type: "Restaurant", foodType: "New American", kidFriendly: "maybe", vibe: "Upstairs cocktail lounge with shared plates", goodFor: "Cocktails, date night", happyHour: false, dinner: true, lunch: false, brunch: false, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 67, name: "Le French Cafe", location: "Boulder", type: "Restaurant", foodType: "French", kidFriendly: "yes", vibe: "Cafe", goodFor: "Breakfast, pastries, French lunch", happyHour: false, dinner: true, lunch: true, brunch: true, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 68, name: "Le Frigo", location: "Boulder", type: "Takeout", foodType: "Deli", kidFriendly: "maybe", vibe: "European deli with gourmet provisions", goodFor: "Lunch sandwiches, cheese and charcuterie", happyHour: false, dinner: false, lunch: true, brunch: false, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 69, name: "Lefthand Brewing", location: "Longmont", type: "Brewery", foodType: "Brewery", kidFriendly: "maybe", vibe: "Award-winning neighborhood brewery", goodFor: "Craft beer, casual gathering", happyHour: false, dinner: false, lunch: false, brunch: false, outdoor: true, notableOutdoor: false, notes: "" },
  { id: 70, name: "License No 1", location: "Boulder", type: "Bar", foodType: "Bar", kidFriendly: "no", vibe: "Cocktail bar", goodFor: "Date night, cocktails, live music", happyHour: false, dinner: false, lunch: false, brunch: false, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 71, name: "Liquid Mechanics", location: "Lafayette", type: "Brewery", foodType: "Brewery", kidFriendly: "yes", vibe: "Award-winning neighborhood craft brewery", goodFor: "Craft beer, neighborhood hangout", happyHour: true, dinner: true, lunch: false, brunch: false, outdoor: true, notableOutdoor: false, notes: "" },
  { id: 72, name: "Lucille's", location: "Boulder", type: "Restaurant", foodType: "Creole", kidFriendly: "", vibe: "", goodFor: "", happyHour: false, dinner: false, lunch: false, brunch: true, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 73, name: "Lucille's", location: "Longmont", type: "Restaurant", foodType: "Creole", kidFriendly: "", vibe: "", goodFor: "", happyHour: false, dinner: false, lunch: false, brunch: true, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 74, name: "Lucky Pie", location: "Louisville", type: "Restaurant", foodType: "Pizza", kidFriendly: "yes", vibe: "Casual Neapolitan pizzeria with craft beer", goodFor: "Pizza, casual family dinner", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: true, notableOutdoor: false, notes: "" },
  { id: 75, name: "Marigold", location: "Lyons", type: "Restaurant", foodType: "Italian", kidFriendly: "maybe", vibe: "French-Italian fusion", goodFor: "Special occasion, date night, wine", happyHour: false, dinner: true, lunch: false, brunch: false, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 77, name: "McDevitts Tacos", location: "Boulder", type: "Restaurant", foodType: "Mexican", kidFriendly: "yes", vibe: "cozy trendy casual", goodFor: "Quick lunch, creative tacos", happyHour: true, dinner: true, lunch: true, brunch: false, outdoor: true, notableOutdoor: false, notes: "Great margs and queso, tasty tacos, affordable and laid back" },
  { id: 78, name: "Mountain Sun", location: "Boulder", type: "Brewery & Restaurant", foodType: "American", kidFriendly: "maybe", vibe: "Pub", goodFor: "Craft beer, pub food, live music", happyHour: true, dinner: true, lunch: true, brunch: false, outdoor: false, notableOutdoor: false, notes: "Boulder classic, delicious burgers and sandwiches, wings and nachos, solid beer, affordable delicious food and laid back atmosphere" },
  { id: 79, name: "Mt Everest", location: "Boulder", type: "Restaurant", foodType: "Indian", kidFriendly: "yes", vibe: "Casual Himalayan and Indian cuisine", goodFor: "take out", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 80, name: "New Terrain Brewing", location: "Golden", type: "Brewery", foodType: "Brewery", kidFriendly: "maybe", vibe: "Brewpub with scenic mountain views and beer garden", goodFor: "Craft beer, casual dining, scenic views", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: true, notableOutdoor: true, notes: "" },
  { id: 81, name: "Niwot Tavern", location: "Niwot", type: "Restaurant", foodType: "American", kidFriendly: "maybe", vibe: "Casual neighborhood bar and grill", goodFor: "Casual dining, specials", happyHour: true, dinner: true, lunch: true, brunch: true, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 82, name: "Nora's Place", location: "Louisville", type: "Bar", foodType: "Bar", kidFriendly: "no", vibe: "Cocktail bar", goodFor: "Date night, craft cocktails", happyHour: true, dinner: false, lunch: false, brunch: false, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 83, name: "Oak", location: "Boulder", type: "Restaurant", foodType: "New American", kidFriendly: "maybe", vibe: "Neighborhood New American with oak-fired oven", goodFor: "Special occasion, seasonal menus", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 84, name: "Odd 13", location: "Lafayette", type: "Brewery", foodType: "Brewery", kidFriendly: "maybe", vibe: "Experimental craft brewery with food trucks", goodFor: "Craft beer, casual gathering", happyHour: false, dinner: true, lunch: false, brunch: false, outdoor: true, notableOutdoor: false, notes: "" },
  { id: 85, name: "Osaka", location: "Boulder", type: "Restaurant", foodType: "Japanese", kidFriendly: "yes", vibe: "Upscale casual, Family oriented", goodFor: "", happyHour: false, dinner: true, lunch: false, brunch: false, outdoor: false, notableOutdoor: false, notes: "sushi was meh, the ramen and other main courses are good, they have okonomiyaki burgers on some days! Quite busy, recommendations recommended" },
  { id: 86, name: "Oskar Blues", location: "Longmont", type: "Brewery & Restaurant", foodType: "American", kidFriendly: "maybe", vibe: "Pub", goodFor: "enclosed fenced in area", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: true, notableOutdoor: false, notes: "" },
  { id: 87, name: "Parkway Diner", location: "Boulder", type: "Restaurant", foodType: "Mexican", kidFriendly: "yes", vibe: "Breakfast focus", goodFor: "Breakfast, Mexican specialties", happyHour: false, dinner: false, lunch: true, brunch: true, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 88, name: "Pica's", location: "Boulder", type: "Restaurant", foodType: "Mexican", kidFriendly: "yes", vibe: "Counter service but still charming", goodFor: "", happyHour: true, dinner: true, lunch: true, brunch: false, outdoor: true, notableOutdoor: false, notes: "Adorable patio, great spot for lunch or after work margaritas, ordering is fast food style but food is delicious, fast, and affordable" },
  { id: 89, name: "Pica's Louisville", location: "Louisville", type: "Restaurant", foodType: "Mexican", kidFriendly: "yes", vibe: "Casual Mexican taqueria with outdoor seating", goodFor: "Quick lunch, handmade tortillas", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: true, notableOutdoor: false, notes: "" },
  { id: 90, name: "Pizzeria Locale", location: "Boulder", type: "Restaurant", foodType: "Italian", kidFriendly: "yes", vibe: "Neapolitan pizzeria", goodFor: "Pizza, casual Italian dining", happyHour: true, dinner: true, lunch: false, brunch: false, outdoor: true, notableOutdoor: false, notes: "great place to go sit at the bar and get drinks and apps or an after dinner drink, can be a long wait, not cheap but delicious prosciutto and arancini and fun to people watch" },
  { id: 91, name: "Post Boulder", location: "Boulder", type: "Restaurant", foodType: "American", kidFriendly: "yes", vibe: "Chicken", goodFor: "", happyHour: false, dinner: true, lunch: true, brunch: true, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 92, name: "Post Lafayette", location: "Lafayette", type: "Restaurant", foodType: "American", kidFriendly: "yes", vibe: "Chicken", goodFor: "", happyHour: false, dinner: true, lunch: true, brunch: true, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 93, name: "Post Longmont", location: "Longmont", type: "Restaurant", foodType: "American", kidFriendly: "yes", vibe: "Chicken", goodFor: "", happyHour: false, dinner: true, lunch: true, brunch: true, outdoor: true, notableOutdoor: false, notes: "" },
  { id: 94, name: "Postinos", location: "Boulder", type: "Restaurant", foodType: "Italian", kidFriendly: "maybe", vibe: "Wine bar", goodFor: "Date night, wine, charcuterie", happyHour: true, dinner: true, lunch: true, brunch: true, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 95, name: "Ras Kaasa", location: "Lafayette", type: "Restaurant", foodType: "Ethiopian", kidFriendly: "yes", vibe: "Casual family-style Ethiopian", goodFor: "Ethiopian family-style dining", happyHour: false, dinner: true, lunch: false, brunch: false, outdoor: false, notableOutdoor: false, notes: "Used to be in Boulder, delicious Ethiopian food, average atmosphere" },
  { id: 96, name: "Rayback Collective", location: "Boulder", type: "Food Hall", foodType: "Multi-vendor", kidFriendly: "yes", vibe: "Food truck park with bar and outdoor seating", goodFor: "Casual group gathering, craft beer, dog-friendly", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: true, notableOutdoor: true, notes: "" },
  { id: 97, name: "Rincon Argentino", location: "Boulder", type: "Restaurant", foodType: "Argentine", kidFriendly: "yes", vibe: "Casual Argentine eatery", goodFor: "Argentine specialties, casual family meal", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: true, notableOutdoor: false, notes: "" },
  { id: 98, name: "Rincon Del Sol", location: "Boulder", type: "Restaurant", foodType: "Mexican", kidFriendly: "yes", vibe: "Festive Mexican restaurant with bright decor", goodFor: "Mexican specialties, casual family dining", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: true, notableOutdoor: false, notes: "" },
  { id: 99, name: "Rio", location: "Boulder", type: "Restaurant", foodType: "Mexican", kidFriendly: "yes", vibe: "Trendy casual", goodFor: "Casual meals, family dining", happyHour: true, dinner: true, lunch: true, brunch: false, outdoor: true, notableOutdoor: true, notes: "GREAT rooftop and solid americanized Mexican food, often super busy, fave spot for tourists & college students with families - reservations are helpful" },
  { id: 100, name: "River and Woods", location: "Boulder", type: "Restaurant", foodType: "New American", kidFriendly: "maybe", vibe: "Upscale comfort food in historic miner's cabin", goodFor: "Date night, special occasions, weekend brunch", happyHour: true, dinner: true, lunch: true, brunch: true, outdoor: true, notableOutdoor: false, notes: "" },
  { id: 101, name: "Rocky Flats Beergarden", location: "Boulder", type: "Bar & Restaurant", foodType: "American", kidFriendly: "yes", vibe: "Beer garden", goodFor: "Group outings, families, dogs", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: true, notableOutdoor: true, notes: "" },
  { id: 102, name: "Rocky Mountain Tap & Garden", location: "Arvada", type: "Bar & Restaurant", foodType: "American", kidFriendly: "maybe", vibe: "Casual bar with self-pour tap wall", goodFor: "Casual drinks, laid-back vibe", happyHour: true, dinner: true, lunch: false, brunch: false, outdoor: true, notableOutdoor: false, notes: "" },
  { id: 103, name: "Roost", location: "Longmont", type: "Restaurant", foodType: "New American", kidFriendly: "maybe", vibe: "Casual craft restaurant with rooftop dining", goodFor: "Brunch, dinner, group meals", happyHour: false, dinner: true, lunch: true, brunch: true, outdoor: true, notableOutdoor: false, notes: "" },
  { id: 104, name: "Rosetta Hall", location: "Boulder", type: "Food Hall", foodType: "Multi-vendor", kidFriendly: "yes", vibe: "Modern luxe food hall with multiple cuisines", goodFor: "Diverse dining, groups", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: true, notableOutdoor: true, notes: "" },
  { id: 105, name: "Salt", location: "Boulder", type: "Restaurant", foodType: "New American", kidFriendly: "maybe", vibe: "Cozy-fine dining, locally sourced", goodFor: "Date night, special occasions", happyHour: true, dinner: true, lunch: true, brunch: true, outdoor: true, notableOutdoor: false, notes: "" },
  { id: 106, name: "Santos", location: "Boulder", type: "Restaurant", foodType: "Mexican", kidFriendly: "yes", vibe: "New Mexican style", goodFor: "Dinner, breakfast burritos, lunch", happyHour: false, dinner: true, lunch: true, brunch: true, outdoor: true, notableOutdoor: true, notes: "" },
  { id: 107, name: "Sherpas Downtown", location: "Boulder", type: "Restaurant", foodType: "Indian", kidFriendly: "yes", vibe: "Nepalese", goodFor: "Lunch, dinner, families", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 108, name: "Sherpas in East Boulder", location: "Boulder", type: "Takeout", foodType: "Indian", kidFriendly: "yes", vibe: "Nepalese", goodFor: "Quick meals, lunch", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 109, name: "Shoes and Brews", location: "Longmont", type: "Brewery", foodType: "Brewery", kidFriendly: "yes", vibe: "Running shoe store with taproom", goodFor: "Casual drinks, community gatherings", happyHour: false, dinner: false, lunch: false, brunch: false, outdoor: true, notableOutdoor: false, notes: "" },
  { id: 110, name: "Snarfburger", location: "Boulder", type: "Takeout", foodType: "Burgers", kidFriendly: "yes", vibe: "Casual burger shack, quick service", goodFor: "Quick lunch, burgers", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 111, name: "Snooze", location: "Boulder", type: "Restaurant", foodType: "Brunch/Cafe", kidFriendly: "yes", vibe: "Trendy brunch spot with full bar", goodFor: "Brunch, breakfast", happyHour: false, dinner: false, lunch: false, brunch: true, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 112, name: "South Side Walnut Cafe", location: "Boulder", type: "Restaurant", foodType: "Brunch/Cafe", kidFriendly: "yes", vibe: "Casual neighborhood breakfast cafe", goodFor: "Brunch, breakfast, lunch", happyHour: false, dinner: false, lunch: true, brunch: true, outdoor: true, notableOutdoor: false, notes: "" },
  { id: 113, name: "Southern Sun", location: "Boulder", type: "Brewery & Restaurant", foodType: "American", kidFriendly: "maybe", vibe: "Pub", goodFor: "Beer, burgers, casual dining", happyHour: true, dinner: true, lunch: true, brunch: false, outdoor: true, notableOutdoor: false, notes: "Nice patio if you can get a spot, Boulder classic, delicious burgers and sandwiches, wings and nachos, solid beer, affordable delicious food and laid back atmosphere" },
  { id: 114, name: "Spruce and Fish at the Boulderado", location: "Boulder", type: "Restaurant", foodType: "Seafood", kidFriendly: "maybe", vibe: "Upscale seafood in historic building", goodFor: "Date night, special occasions, brunch", happyHour: false, dinner: true, lunch: false, brunch: true, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 115, name: "Stella's", location: "Boulder", type: "Restaurant", foodType: "Italian", kidFriendly: "no", vibe: "Swanky great gatsby, Mediterranean influenced", goodFor: "Date night, special occasions", happyHour: false, dinner: true, lunch: false, brunch: false, outdoor: false, notableOutdoor: false, notes: "FANCY and PRICEY. Fun atmosphere and cool design - good place for a nice date or a special occasion with friends" },
  { id: 116, name: "Sushi Zanmai", location: "Boulder", type: "Restaurant", foodType: "Asian", kidFriendly: "maybe", vibe: "Japanese sushi bar with karaoke", goodFor: "Dinner, karaoke", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 117, name: "Swaylo's", location: "Longmont", type: "Restaurant", foodType: "Bar", kidFriendly: "yes", vibe: "Hawaiian tiki", goodFor: "Family dinner, casual drinks", happyHour: false, dinner: true, lunch: false, brunch: false, outdoor: true, notableOutdoor: false, notes: "" },
  { id: 118, name: "T/ACO", location: "Boulder", type: "Restaurant", foodType: "Mexican", kidFriendly: "yes", vibe: "cozy trendy casual", goodFor: "Quick tacos, happy hour, lunch", happyHour: true, dinner: true, lunch: true, brunch: false, outdoor: true, notableOutdoor: false, notes: "Delicious tacos and queso, great margs, tacos are better than centro and rio" },
  { id: 119, name: "Tangerine", location: "Boulder", type: "Restaurant", foodType: "Asian", kidFriendly: "yes", vibe: "Southeast Asian", goodFor: "Brunch, lunch, fresh local ingredients", happyHour: false, dinner: false, lunch: true, brunch: true, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 120, name: "Teocalli Cocina", location: "Lafayette", type: "Restaurant", foodType: "Mexican", kidFriendly: "yes", vibe: "Modern Mexican with traditional focus", goodFor: "Lunch, dinner", happyHour: true, dinner: true, lunch: true, brunch: false, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 121, name: "The Attic", location: "Boulder", type: "Bar", foodType: "Bar", kidFriendly: "no", vibe: "Neighborhood bar with Wisconsin-style food", goodFor: "Drinks, happy hour, pool", happyHour: true, dinner: true, lunch: false, brunch: false, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 122, name: "The Sink", location: "Boulder", type: "Restaurant", foodType: "Burgers", kidFriendly: "yes", vibe: "Also pizza", goodFor: "Burgers, casual meals, college atmosphere", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 123, name: "Tierra y Fuego Taqueria", location: "Boulder", type: "Restaurant", foodType: "Mexican", kidFriendly: "yes", vibe: "Casual authentic Mexican", goodFor: "Quick meals, breakfast burritos, lunch", happyHour: false, dinner: true, lunch: true, brunch: true, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 124, name: "Tiffins India Cafe", location: "Boulder", type: "Takeout", foodType: "Indian", kidFriendly: "maybe", vibe: "Casual Indian takeout", goodFor: "take out", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 125, name: "Tip Top Pies", location: "Lafayette", type: "Restaurant", foodType: "Other", kidFriendly: "yes", vibe: "New Zealand pies", goodFor: "Quick lunch, pastries, pies", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 126, name: "Twisted Pine Brewing", location: "Boulder", type: "Brewery & Restaurant", foodType: "Pizza", kidFriendly: "yes", vibe: "Neighborhood brewery with pizza", goodFor: "Craft beer, pizza, casual hangout", happyHour: false, dinner: true, lunch: false, brunch: false, outdoor: true, notableOutdoor: false, notes: "" },
  { id: 128, name: "Urban Field Pizza", location: "Longmont", type: "Restaurant", foodType: "Pizza", kidFriendly: "yes", vibe: "Casual pizza and market restaurant", goodFor: "Pizza, lunch, market items", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 129, name: "Vision Quest Brewing", location: "Boulder", type: "Brewery", foodType: "Brewery", kidFriendly: "yes", vibe: "Neighborhood craft brewery", goodFor: "Beer tasting, casual hangout", happyHour: false, dinner: false, lunch: false, brunch: false, outdoor: true, notableOutdoor: false, notes: "" },
  { id: 130, name: "Walnut Cafe", location: "Boulder", type: "Restaurant", foodType: "Brunch/Cafe", kidFriendly: "yes", vibe: "", goodFor: "Brunch, breakfast, lunch", happyHour: false, dinner: false, lunch: true, brunch: true, outdoor: true, notableOutdoor: false, notes: "" },
  { id: 131, name: "Waterloo", location: "Louisville", type: "Bar & Restaurant", foodType: "Burgers", kidFriendly: "maybe", vibe: "Vibrant bar and music venue with burgers", goodFor: "Live music, burgers, cocktails", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 132, name: "West End", location: "Boulder", type: "Bar & Restaurant", foodType: "American", kidFriendly: "maybe", vibe: "Neighborhood tavern with rooftop patio", goodFor: "Burgers, BBQ, drinks", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: true, notableOutdoor: false, notes: "" },
  { id: 133, name: "West Side Tavern", location: "Longmont", type: "Restaurant", foodType: "American", kidFriendly: "maybe", vibe: "Gastropub", goodFor: "Dinner, cocktails", happyHour: false, dinner: true, lunch: false, brunch: true, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 134, name: "Westbound and Down", location: "Louisville", type: "Brewery & Restaurant", foodType: "Brewery", kidFriendly: "maybe", vibe: "Historic brewery with restaurant", goodFor: "Craft beer, casual dining", happyHour: false, dinner: true, lunch: true, brunch: true, outdoor: true, notableOutdoor: false, notes: "" },
  { id: 135, name: "Wibby Brewing", location: "Longmont", type: "Restaurant", foodType: "Brewery", kidFriendly: "maybe", vibe: "Craft lager brewery, family-friendly", goodFor: "Beer tasting, casual hangout, families", happyHour: false, dinner: false, lunch: false, brunch: false, outdoor: true, notableOutdoor: false, notes: "" },
  { id: 136, name: "Wild Provisions", location: "Boulder", type: "Brewery", foodType: "Brewery", kidFriendly: "yes", vibe: "Modern craft brewery with beer garden", goodFor: "Beer tasting, casual hangout", happyHour: false, dinner: false, lunch: false, brunch: false, outdoor: true, notableOutdoor: false, notes: "" },
  { id: 137, name: "Wonderland Brewing", location: "Broomfield", type: "Brewery", foodType: "Brewery", kidFriendly: "yes", vibe: "Family-friendly brewery with games and mini golf", goodFor: "Family outings, entertainment", happyHour: false, dinner: true, lunch: false, brunch: false, outdoor: true, notableOutdoor: true, notes: "" },
  { id: 138, name: "Yotsuba Sushi", location: "Boulder", type: "Restaurant", foodType: "Japanese", kidFriendly: "maybe", vibe: "Contemporary Japanese sushi restaurant", goodFor: "Lunch, dinner, quality sushi", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 139, name: "Zoe Ma Ma", location: "Boulder", type: "Restaurant", foodType: "Asian", kidFriendly: "yes", vibe: "Chinese", goodFor: "Quick lunch, dinner, authentic Chinese", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: false, notableOutdoor: false, notes: "" },
  { id: 140, name: "Lucky's Bakehouse Cafe", location: "Boulder", type: "Restaurant", foodType: "Brunch/Cafe", kidFriendly: "yes", vibe: "Casual, lively", goodFor: "Brunch, lunch", happyHour: false, dinner: false, lunch: true, brunch: true, outdoor: true, notableOutdoor: false, notes: "Chef-inspired American cuisine, locally sourced ingredients, organic coffee. Popular hashes, omelets, benedicts." },
  { id: 141, name: "Lucky's Bakehouse & Creamery", location: "Boulder", type: "Restaurant", foodType: "French", kidFriendly: "yes", vibe: "Bakery", goodFor: "Pastries, baked goods, ice cream", happyHour: false, dinner: false, lunch: true, brunch: true, outdoor: false, notableOutdoor: false, notes: "Everything made fresh daily in small batches. Two-day croissants, cream puffs, elegant pastries, ice cream." },
  { id: 142, name: "Shamane's Bake Shoppe", location: "Boulder", type: "Restaurant", foodType: "French", kidFriendly: "yes", vibe: "Bakery, artisanal", goodFor: "Pastries, breakfast, lunch, custom cakes", happyHour: false, dinner: false, lunch: true, brunch: true, outdoor: true, notableOutdoor: false, notes: "Scratch-made pastries, croissants, quiches, sandwiches. Closed Sun-Mon. Open 7:30am-3pm." },
  { id: 143, name: "Cozobi Fonda Fina", location: "Boulder", type: "Restaurant", foodType: "Mexican", kidFriendly: "yes", vibe: "Upscale casual, wood-fire, corn-focused", goodFor: "Date night, dinner", happyHour: false, dinner: true, lunch: false, brunch: false, outdoor: false, notableOutdoor: false, notes: "Michelin Bib Gourmand. Corn nixtamalized in-house." },
  { id: 144, name: "Maisonette", location: "Boulder", type: "Restaurant", foodType: "Brunch/Cafe", kidFriendly: "yes", vibe: "Cozy, authentic French bakery", goodFor: "Pastries, breakfast, brunch", happyHour: false, dinner: false, lunch: true, brunch: true, outdoor: false, notableOutdoor: false, notes: "Michelin-trained chef. Fresh pastries daily, often sells out." },
  { id: 145, name: "Siren Cocktail Bar", location: "Boulder", type: "Bar", foodType: "Bar", kidFriendly: "maybe", vibe: "Nautical East Coast tavern, cocktail bar", goodFor: "Drinks, date night", happyHour: false, dinner: false, lunch: false, brunch: false, outdoor: false, notableOutdoor: false, notes: "Sister bar to Jungle. Sophisticated cocktails, caviar offerings." },
  { id: 146, name: "C Bar", location: "Boulder", type: "Bar", foodType: "Bar", kidFriendly: "", vibe: "Elegant mid-century modern, cocktail bar", goodFor: "Drinks, date night", happyHour: false, dinner: false, lunch: false, brunch: false, outdoor: false, notableOutdoor: false, notes: "Classic and inventive cocktails, haute bar fare." },
  { id: 147, name: "Proto's Pizza North Boulder", location: "Boulder", type: "Restaurant", foodType: "Pizza", kidFriendly: "yes", vibe: "Fun, casual", goodFor: "", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: false, notableOutdoor: false, notes: "Thin charred crust pizza since 1999. Full bar." },
  { id: 148, name: "Proto's Pizza Gunbarrel", location: "Gunbarrel", type: "Restaurant", foodType: "Pizza", kidFriendly: "yes", vibe: "Fun, casual", goodFor: "", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: false, notableOutdoor: false, notes: "Hand-tossed authentic Italian pizza." },
  { id: 149, name: "Call Your Mother", location: "Boulder", type: "Restaurant", foodType: "Deli", kidFriendly: "yes", vibe: "Playful Brooklyn-meets-Boca", goodFor: "Breakfast, lunch, bagels", happyHour: false, dinner: false, lunch: true, brunch: true, outdoor: false, notableOutdoor: false, notes: "Fresh-baked bagels daily. 29th Street Mall location." },
  { id: 150, name: "Aperitivo", location: "Gunbarrel", type: "Restaurant", foodType: "New American", kidFriendly: "yes", vibe: "Sleek modern, understated elegance", goodFor: "Brunch, dinner, date night", happyHour: false, dinner: true, lunch: true, brunch: true, outdoor: true, notableOutdoor: false, notes: "Global fusion, locally sourced. Great patio." },
  { id: 151, name: "Bucatino Trattoria Romana", location: "Lafayette", type: "Restaurant", foodType: "Italian", kidFriendly: "maybe", vibe: "Rustic modern, spacious", goodFor: "Dinner", happyHour: false, dinner: true, lunch: false, brunch: false, outdoor: false, notableOutdoor: false, notes: "Chef Marco Monnanni. Homemade thick hollow pasta. Full bar." },
  { id: 152, name: "Dillinger's Food & Spirits", location: "Lafayette", type: "Bar & Restaurant", foodType: "American", kidFriendly: "maybe", vibe: "Casual neighborhood bar", goodFor: "Live music, drinks", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: false, notableOutdoor: false, notes: "30+ years. Live bands Fri, karaoke Wed/Sat." },
  { id: 153, name: "Moxie Bread Co", location: "Louisville", type: "Restaurant", foodType: "Brunch/Cafe", kidFriendly: "yes", vibe: "Community bakery in historic home", goodFor: "Pastries, breakfast, lunch", happyHour: false, dinner: false, lunch: true, brunch: true, outdoor: false, notableOutdoor: false, notes: "Organic fresh-milled heirloom grains." },
  { id: 154, name: "Parma Trattoria & Mozzarella Bar", location: "Louisville", type: "Restaurant", foodType: "Italian", kidFriendly: "maybe", vibe: "Casual elegant", goodFor: "Dinner, date night", happyHour: false, dinner: true, lunch: false, brunch: false, outdoor: true, notableOutdoor: false, notes: "Fresh mozzarella bar. Organic ingredients." },
  { id: 155, name: "740 Front", location: "Louisville", type: "Restaurant", foodType: "New American", kidFriendly: "maybe", vibe: "Historic 1904 saloon, elegant", goodFor: "Dinner, date night, special occasion", happyHour: false, dinner: true, lunch: false, brunch: false, outdoor: false, notableOutdoor: false, notes: "Historic landmark with 1880 bar. Steaks. Four private rooms." },
  { id: 156, name: "12 Degree Brewing", location: "Louisville", type: "Brewery", foodType: "Brewery", kidFriendly: "yes", vibe: "Belgian-inspired community taproom", goodFor: "", happyHour: false, dinner: false, lunch: false, brunch: false, outdoor: false, notableOutdoor: false, notes: "Small Brewpub of the Year 2016. Cheese and chocolate pairings." },
  { id: 157, name: "Gravity Brewing", location: "Louisville", type: "Brewery", foodType: "Brewery", kidFriendly: "yes", vibe: "Laid-back neighborhood brewery", goodFor: "", happyHour: false, dinner: false, lunch: false, brunch: false, outdoor: false, notableOutdoor: false, notes: "Award-winning craft beers. Pizza from Double D's Sourdough Pizzeria." },
  { id: 158, name: "LuLu's BBQ", location: "Louisville", type: "Restaurant", foodType: "American", kidFriendly: "yes", vibe: "Casual, BBQ", goodFor: "Lunch, dinner", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: false, notableOutdoor: false, notes: "Texas-style low and slow. Daily smoked meats, usually sold out by evening." },
  { id: 159, name: "The Huckleberry", location: "Louisville", type: "Restaurant", foodType: "Brunch/Cafe", kidFriendly: "yes", vibe: "Fun, creative comfort", goodFor: "Brunch, breakfast", happyHour: false, dinner: false, lunch: true, brunch: true, outdoor: false, notableOutdoor: false, notes: "Historic 1898 building. On-site bakery. Funky Country cuisine." },
  { id: 160, name: "Longs Peak Pub", location: "Longmont", type: "Brewery & Restaurant", foodType: "American", kidFriendly: "yes", vibe: "Pub, spacious patio", goodFor: "", happyHour: false, dinner: true, lunch: true, brunch: false, outdoor: true, notableOutdoor: false, notes: "Mountain Sun group. 21 craft beers on tap. Cornhole. No TV." },
  { id: 161, name: "Martinis Bistro", location: "Longmont", type: "Restaurant", foodType: "New American", kidFriendly: "maybe", vibe: "Elegant classic, 1890s home", goodFor: "Dinner, date night, special occasion", happyHour: true, dinner: true, lunch: false, brunch: false, outdoor: false, notableOutdoor: false, notes: "Famous for generous martinis. Happy hour available." },
  { id: 162, name: "Cimmini's", location: "Niwot", type: "Restaurant", foodType: "Italian", kidFriendly: "maybe", vibe: "Cozy neighborhood Italian", goodFor: "Dinner", happyHour: false, dinner: true, lunch: false, brunch: false, outdoor: false, notableOutdoor: false, notes: "Family-owned, chef-led. Authentic made-from-scratch dishes." }
];

const TYPE_COLORS = {
  "Restaurant": "from-violet-500 to-purple-600",
  "Brewery": "from-amber-500 to-yellow-600",
  "Brewery & Restaurant": "from-orange-500 to-amber-600",
  "Bar": "from-rose-500 to-pink-600",
  "Bar & Restaurant": "from-fuchsia-500 to-pink-600",
  "Food Hall": "from-emerald-500 to-teal-600",
  "Takeout": "from-sky-500 to-blue-600",
};

const TYPE_BG = {
  "Restaurant": "bg-violet-100 text-violet-700",
  "Brewery": "bg-amber-100 text-amber-700",
  "Brewery & Restaurant": "bg-orange-100 text-orange-700",
  "Bar": "bg-rose-100 text-rose-700",
  "Bar & Restaurant": "bg-fuchsia-100 text-fuchsia-700",
  "Food Hall": "bg-emerald-100 text-emerald-700",
  "Takeout": "bg-sky-100 text-sky-700",
};

// ===== DISTANCE CALCULATION =====
function haversine(lat1, lng1, lat2, lng2) {
  const R = 3959; // Earth radius in miles
  const dLat = ((lat2 - lat1) * Math.PI) / 180;
  const dLng = ((lng2 - lng1) * Math.PI) / 180;
  const a = Math.sin(dLat / 2) ** 2 +
    Math.cos((lat1 * Math.PI) / 180) * Math.cos((lat2 * Math.PI) / 180) *
    Math.sin(dLng / 2) ** 2;
  return R * 2 * Math.asin(Math.sqrt(a));
}

function Toggle({ label, active, onClick, color = "blue" }) {
  const colors = {
    blue: active ? "bg-violet-600 text-white shadow-lg shadow-violet-200" : "bg-white text-gray-700 hover:bg-gray-50 border border-gray-300 shadow-sm",
    green: active ? "bg-emerald-500 text-white shadow-lg shadow-emerald-200" : "bg-white text-gray-700 hover:bg-gray-50 border border-gray-300 shadow-sm",
    amber: active ? "bg-amber-500 text-white shadow-lg shadow-amber-200" : "bg-white text-gray-700 hover:bg-gray-50 border border-gray-300 shadow-sm",
    purple: active ? "bg-purple-600 text-white shadow-lg shadow-purple-200" : "bg-white text-gray-700 hover:bg-gray-50 border border-gray-300 shadow-sm",
    rose: active ? "bg-rose-500 text-white shadow-lg shadow-rose-200" : "bg-white text-gray-700 hover:bg-gray-50 border border-gray-300 shadow-sm",
    teal: active ? "bg-teal-500 text-white shadow-lg shadow-teal-200" : "bg-white text-gray-700 hover:bg-gray-50 border border-gray-300 shadow-sm",
  };
  return (
    <button
      onClick={onClick}
      className={`text-xs font-semibold px-3.5 py-1.5 rounded-full transition-all ${colors[color]}`}
    >
      {label}
    </button>
  );
}

// ===== EDIT FORM COMPONENT (with Google Places Autocomplete) =====
function EditForm({ place, onSave, onCancel, locations, types, foodTypes, existingPlaces }) {
  const [form, setForm] = useState({ ...place });
  const set = (field, val) => setForm((f) => ({ ...f, [field]: val }));
  const nameInputRef = useRef(null);
  const autocompleteRef = useRef(null);

  // Check for duplicate name (only when adding new, not editing)
  const isNewPlace = !place.id && !place._docId;
  const duplicateMatch = isNewPlace && form.name && form.name.trim().length > 2
    ? (existingPlaces || []).find((p) => p.name && p.name.toLowerCase().trim() === form.name.toLowerCase().trim())
    : null;

  // Set up Google Places Autocomplete on the name input
  // Uses polling to wait for Google Maps API to load (it loads async)
  useEffect(() => {
    if (autocompleteRef.current) return;
    if (!nameInputRef.current) return;

    const tryInit = () => {
      if (!window.google || !window.google.maps || !window.google.maps.places) return false;

      const ac = new google.maps.places.Autocomplete(nameInputRef.current, {
        types: ["establishment"],
        componentRestrictions: { country: "us" },
        fields: ["name", "formatted_address", "geometry", "place_id", "formatted_phone_number", "website"]
      });

      ac.addListener("place_changed", () => {
        const p = ac.getPlace();
        if (!p || !p.name) return;
        setForm((f) => ({
          ...f,
          name: p.name || f.name,
          address: p.formatted_address || "",
          googlePlaceId: p.place_id || "",
          phone: p.formatted_phone_number || "",
          website: p.website || "",
          lat: p.geometry && p.geometry.location ? p.geometry.location.lat() : null,
          lng: p.geometry && p.geometry.location ? p.geometry.location.lng() : null,
        }));
      });

      autocompleteRef.current = ac;
      return true;
    };

    // Try immediately, then poll every 500ms for up to 10 seconds
    if (!tryInit()) {
      let attempts = 0;
      const interval = setInterval(() => {
        attempts++;
        if (tryInit() || attempts >= 20) clearInterval(interval);
      }, 500);
      return () => clearInterval(interval);
    }
  }, []);

  return (
    <div className="relative bg-purple-50 rounded-xl p-4 space-y-3 border-2 border-purple-200">
      <button onClick={onCancel} className="absolute top-2 right-2 w-7 h-7 flex items-center justify-center rounded-full bg-purple-200 hover:bg-purple-300 text-purple-700 font-bold text-sm leading-none">&times;</button>
      <div className="flex justify-between items-center mb-1 pr-8">
        <h3 className="text-sm font-black text-purple-700">{place.id ? "Edit Place" : "Add New Place"}</h3>
      </div>

      {/* Row 1: Name with Google Autocomplete */}
      <div>
        <input ref={nameInputRef} value={form.name || ""} onChange={(e) => set("name", e.target.value)} placeholder={window.GOOGLE_MAPS_READY ? "Start typing a place name..." : "Name *"} className="w-full border-2 border-purple-100 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-purple-300" />
        {form.address && (
          <p className="text-xs text-gray-400 mt-1 px-1">{form.address}</p>
        )}
        {duplicateMatch && (
          <p className="text-xs text-amber-600 font-medium mt-1 px-1 bg-amber-50 rounded-lg py-1.5">
            Heads up: "{duplicateMatch.name}" is already in your list{duplicateMatch.location ? ` (${duplicateMatch.location})` : ""}. You can still add it if this is a different location.
          </p>
        )}
      </div>

      {/* Row 2: Location + Type */}
      <div className="flex gap-2">
        <select value={form.location || ""} onChange={(e) => set("location", e.target.value)} className="flex-1 border-2 border-purple-100 rounded-lg px-2 py-2 text-sm bg-white">
          <option value="">Location...</option>
          {locations.map((l) => <option key={l} value={l}>{l}</option>)}
        </select>
        <select value={form.type || ""} onChange={(e) => set("type", e.target.value)} className="flex-1 border-2 border-purple-100 rounded-lg px-2 py-2 text-sm bg-white">
          <option value="">Type...</option>
          {types.map((t) => <option key={t} value={t}>{t}</option>)}
        </select>
      </div>

      {/* Row 3: Food Type + Kid Friendly */}
      <div className="flex gap-2">
        <select value={form.foodType || ""} onChange={(e) => set("foodType", e.target.value)} className="flex-1 border-2 border-purple-100 rounded-lg px-2 py-2 text-sm bg-white">
          <option value="">Food Type...</option>
          {foodTypes.map((f) => <option key={f} value={f}>{f}</option>)}
        </select>
        <select value={form.kidFriendly || ""} onChange={(e) => set("kidFriendly", e.target.value)} className="flex-1 border-2 border-purple-100 rounded-lg px-2 py-2 text-sm bg-white">
          <option value="">Kid Friendly?</option>
          <option value="yes">Yes</option>
          <option value="maybe">Maybe</option>
          <option value="no">No</option>
        </select>
      </div>

      {/* Row 4: Toggle buttons */}
      <div className="flex flex-wrap gap-1.5">
        {[
          { key: "happyHour", label: "Happy Hour", color: "amber" },
          { key: "dinner", label: "Dinner", color: "purple" },
          { key: "lunch", label: "Lunch", color: "purple" },
          { key: "brunch", label: "Brunch", color: "rose" },
          { key: "outdoor", label: "Outdoor", color: "teal" },
          { key: "notableOutdoor", label: "Great Patio", color: "teal" },
          { key: "dateNight", label: "Date Night", color: "rose" },
          { key: "kidsAndBeers", label: "Kids & Beers", color: "blue" },
        ].map((t) => (
          <Toggle key={t.key} label={t.label} active={!!form[t.key]} onClick={() => set(t.key, !form[t.key])} color={t.color} />
        ))}
      </div>

      {/* Row 5: Vibe + Good For + Notes */}
      <input value={form.vibe || ""} onChange={(e) => set("vibe", e.target.value)} placeholder="Vibe (e.g., Cozy upscale bistro)" className="w-full border-2 border-purple-100 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-purple-300" />
      <input value={form.goodFor || ""} onChange={(e) => set("goodFor", e.target.value)} placeholder="Good for (e.g., Date night, families)" className="w-full border-2 border-purple-100 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-purple-300" />
      <input value={form.notes || ""} onChange={(e) => set("notes", e.target.value)} placeholder="Notes (personal tips, observations)" className="w-full border-2 border-purple-100 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-purple-300" />

      {/* Save button */}
      <button
        onClick={() => { if (form.name) onSave(form); }}
        className="w-full bg-gradient-to-r from-purple-600 to-pink-500 text-white text-sm font-bold py-2.5 rounded-xl shadow-md hover:shadow-lg transition-all"
      >
        {place.id ? "Save Changes" : "Add Place"}
      </button>
    </div>
  );
}

function PlaceRow({ place, isExpanded, onToggle, user, onEdit, onDelete, radiusMode, radiusCenter, openStatus }) {
  const isClosed = openStatus === false;
  const gradient = TYPE_COLORS[place.type] || "from-gray-400 to-gray-500";
  const typeBg = TYPE_BG[place.type] || "bg-gray-100 text-gray-700";

  const badges = [];
  if (place.kidFriendly === "yes") badges.push({ label: "Kid Friendly", color: "bg-emerald-100 text-emerald-700" });
  if (place.kidFriendly === "maybe") badges.push({ label: "Maybe Kids", color: "bg-yellow-100 text-yellow-700" });
  if (place.happyHour) badges.push({ label: "Happy Hour", color: "bg-amber-100 text-amber-700" });
  if (place.outdoor && place.notableOutdoor) badges.push({ label: "Great Patio \u2605", color: "bg-teal-100 text-teal-700" });
  else if (place.outdoor) badges.push({ label: "Patio", color: "bg-teal-100 text-teal-700" });
  if (place.dateNight) badges.push({ label: "Date Night", color: "bg-rose-100 text-rose-700" });
  if (place.kidsAndBeers) badges.push({ label: "Kids & Beers", color: "bg-blue-100 text-blue-700" });

  const meals = [];
  if (place.dinner) meals.push("Dinner");
  if (place.lunch) meals.push("Lunch");
  if (place.brunch) meals.push("Brunch");

  return (
    <div className="overflow-hidden">
      <button
        onClick={onToggle}
        className={`w-full flex items-center gap-2.5 px-3 py-2 rounded-xl transition-all ${
          isExpanded
            ? "bg-white shadow-md ring-2 ring-purple-100"
            : isClosed
              ? "bg-gray-50 shadow-sm hover:shadow-md"
              : "bg-white shadow-sm hover:shadow-md"
        }`}
      >
        <div className={`w-1 h-6 rounded-full bg-gradient-to-b ${gradient} shrink-0`} />
        <span className={`text-sm font-bold truncate flex-1 text-left ${isClosed ? "text-gray-400 italic" : "text-gray-800"}`}>{place.name}</span>
            {isClosed && <span className="text-[10px] font-bold text-red-400 bg-red-50 px-1.5 py-0.5 rounded-full shrink-0">Closed</span>}
            {radiusMode && radiusCenter && place.lat && place.lng && (
              <span className="text-[10px] font-bold text-blue-500 bg-blue-50 px-2 py-0.5 rounded-full shrink-0">
                {haversine(radiusCenter.lat, radiusCenter.lng, place.lat, place.lng).toFixed(1)} mi
              </span>
            )}
        <div className={`w-5 h-5 rounded-full flex items-center justify-center transition-all shrink-0 ${isExpanded ? "bg-purple-100 text-purple-600" : "bg-gray-100 text-gray-400"}`}>
          <span className={`text-xs font-light leading-none transition-transform ${isExpanded ? "rotate-45" : ""}`}>+</span>
        </div>
      </button>

      {isExpanded && (
        <div className="bg-white rounded-b-xl px-3 pb-3 pt-2 -mt-2 shadow-md ring-2 ring-purple-100">
          <div className="flex items-center gap-2 mb-2 flex-wrap pt-1.5 border-t border-purple-50">
            <span className={`text-xs font-bold px-2.5 py-0.5 rounded-full ${typeBg}`}>{place.type}</span>
            <span className="text-xs font-medium text-gray-500">{place.location}</span>
            {place.foodType && <span className="text-xs text-gray-400">&middot; {place.foodType}</span>}
          </div>

          {(badges.length > 0 || meals.length > 0) && (
            <div className="flex gap-1.5 mb-2 flex-wrap">
              {badges.map((b) => (
                <span key={b.label} className={`text-xs font-bold px-2.5 py-0.5 rounded-full ${b.color}`}>{b.label}</span>
              ))}
              {meals.length > 0 && (
                <span className="text-xs font-bold px-2.5 py-0.5 rounded-full bg-purple-100 text-purple-700">
                  {meals.join(" \u00b7 ")}
                </span>
              )}
            </div>
          )}

          {/* Google info: address, directions, phone */}
          {(place.address || place.phone || (place.lat && place.lng)) && (
            <div className="text-xs text-gray-500 space-y-1 mb-2 bg-blue-50 rounded-lg px-3 py-2">
              {place.address && <p>{place.address}</p>}
              <div className="flex flex-wrap gap-3">
                {place.lat && place.lng && (
                  <a href={"https://www.google.com/maps/dir/?api=1&destination=" + place.lat + "," + place.lng} target="_blank" rel="noopener noreferrer" className="text-blue-600 font-bold hover:underline inline-flex items-center gap-1">
                    Get Directions
                  </a>
                )}
                {place.phone && (
                  <a href={"tel:" + place.phone} className="text-blue-600 font-bold hover:underline">{place.phone}</a>
                )}
                {place.website && (
                  <a href={place.website} target="_blank" rel="noopener noreferrer" className="text-blue-600 font-bold hover:underline">Website</a>
                )}
              </div>
            </div>
          )}

          <div className="text-sm text-gray-600 space-y-1">
            {place.vibe && <p><span className="text-purple-400 font-medium">Vibe:</span> {place.vibe}</p>}
            {place.goodFor && <p><span className="text-purple-400 font-medium">Good for:</span> {place.goodFor}</p>}
            {place.notes && <p className="text-gray-400 italic text-xs mt-1.5 bg-gray-50 rounded-lg px-3 py-2">{place.notes}</p>}
            {!place.vibe && !place.goodFor && !place.notes && !place.foodType && badges.length === 0 && meals.length === 0 && (
              <p className="text-gray-300 italic text-xs">No details yet</p>
            )}
          </div>

          {/* Edit/Delete buttons ‚Äî only show when signed in */}
          {user && (
            <div className="flex gap-2 mt-3 pt-2 border-t border-purple-50">
              <button onClick={(e) => { e.stopPropagation(); onEdit(place); }} className="text-xs font-bold text-purple-500 hover:text-purple-700 px-3 py-1.5 rounded-lg hover:bg-purple-50 transition-all">
                Edit
              </button>
              <button onClick={(e) => { e.stopPropagation(); if (confirm("Delete " + place.name + "?")) onDelete(place); }} className="text-xs font-bold text-red-400 hover:text-red-600 px-3 py-1.5 rounded-lg hover:bg-red-50 transition-all">
                Delete
              </button>
            </div>
          )}
        </div>
      )}
    </div>
  );
}

function MultiSelect({ label, allLabel, options, selected, onChange }) {
  const [open, setOpen] = useState(false);
  const ref = useRef(null);

  useEffect(() => {
    const handler = (e) => { if (ref.current && !ref.current.contains(e.target)) setOpen(false); };
    document.addEventListener("mousedown", handler);
    return () => document.removeEventListener("mousedown", handler);
  }, []);

  const toggle = (val) => {
    if (selected.includes(val)) onChange(selected.filter((s) => s !== val));
    else onChange([...selected, val]);
  };

  const selectAll = () => onChange([]);

  const isAll = selected.length === 0;
  const displayText = isAll ? label : selected.length === 1 ? selected[0] : `${selected.length} selected`;

  return (
    <div ref={ref} className="relative">
      <button
        onClick={() => setOpen(!open)}
        className={`flex items-center gap-1 border-2 rounded-xl px-3 py-1.5 text-xs font-medium focus:outline-none focus:ring-2 focus:ring-purple-300 transition-all ${
          selected.length > 0
            ? "bg-purple-50 border-purple-300 text-purple-700"
            : "bg-white border-purple-100 text-gray-600"
        }`}
      >
        <span className="truncate max-w-[120px]">{displayText}</span>
        <span className={`text-[10px] transition-transform ${open ? "rotate-180" : ""}`}>&#9662;</span>
      </button>
      {open && (
        <div className="absolute top-full left-0 mt-1 bg-white border-2 border-purple-100 rounded-xl shadow-lg z-50 min-w-[160px] max-h-[240px] overflow-y-auto py-1">
          <button
            onClick={selectAll}
            className={`w-full text-left px-3 py-1.5 text-xs hover:bg-purple-50 ${
              isAll ? "text-purple-700 font-bold bg-purple-50" : "text-gray-600"
            }`}
          >
            {allLabel}
          </button>
          <div className="border-t border-purple-50 my-0.5" />
          {options.map((opt) => (
            <button
              key={opt}
              onClick={() => toggle(opt)}
              className={`w-full text-left px-3 py-1.5 text-xs hover:bg-purple-50 ${
                selected.includes(opt) ? "text-purple-700 font-bold bg-purple-50" : "text-gray-600"
              }`}
            >
              {opt}
            </button>
          ))}
        </div>
      )}
    </div>
  );
}

function SpotFinder() {
  // === DATA STATE ===
  const [places, setPlaces] = useState(PLACES); // Start with hardcoded data as fallback
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(false);
  const [firebaseActive, setFirebaseActive] = useState(false);
  const [migrating, setMigrating] = useState(false);
  const [migrateStatus, setMigrateStatus] = useState("");

  // === UI STATE ===
  const [expandedId, setExpandedId] = useState(null);
  const [editingPlace, setEditingPlace] = useState(null); // null = not editing, {} = adding new, {id:...} = editing existing
  const [search, setSearch] = useState("");
  const [filterLocations, setFilterLocations] = useState([]);
  const [filterTypes, setFilterTypes] = useState([]);
  const [filterFoodTypes, setFilterFoodTypes] = useState([]);
  const [filterKidFriendly, setFilterKidFriendly] = useState(false);
  const [filterHappyHour, setFilterHappyHour] = useState(false);
  const [filterOutdoor, setFilterOutdoor] = useState(false);
  const [filterDinner, setFilterDinner] = useState(false);
  const [filterLunch, setFilterLunch] = useState(false);
  const [filterBrunch, setFilterBrunch] = useState(false);
  const [filterDateNight, setFilterDateNight] = useState(false);
  const [filterKidsAndBeers, setFilterKidsAndBeers] = useState(false);
  const [openNowCache, setOpenNowCache] = useState({}); // { placeId: { isOpen: bool, checkedAt: timestamp } }
  const [openNowChecked, setOpenNowChecked] = useState(false); // true once we've checked hours
  const [showForm, setShowForm] = useState(false);

  // === RADIUS FILTER STATE ===
  const [radiusMode, setRadiusMode] = useState(null); // null | "nearMe" | "address"
  const [radiusCenter, setRadiusCenter] = useState(null); // { lat, lng, label }
  const [radiusMiles, setRadiusMiles] = useState(5);
  const [geoLoading, setGeoLoading] = useState(false);
  const [geoError, setGeoError] = useState("");
  const addressInputRef = useRef(null);
  const addressAcRef = useRef(null);

  // === GOOGLE NEARBY RESULTS ===
  const [nearbyResults, setNearbyResults] = useState([]);
  const [nearbyLoading, setNearbyLoading] = useState(false);
  const [nearbyShown, setNearbyShown] = useState(false);

  // === FIREBASE AUTH ===
  useEffect(() => {
    if (!FIREBASE_READY) return;
    const unsub = auth.onAuthStateChanged((u) => {
      setUser(u);
      if (!u) { setPlaces(PLACES); setFirebaseActive(false); }
    });
    return unsub;
  }, []);

  // === FIREBASE REAL-TIME DATA ===
  useEffect(() => {
    if (!FIREBASE_READY || !user) return;
    setLoading(true);
    const unsub = db.collection("restaurants").orderBy("name").onSnapshot(
      (snap) => {
        if (snap.empty) {
          // No data in Firebase yet ‚Äî show migration option
          setPlaces([]);
          setFirebaseActive(true);
          setLoading(false);
          return;
        }
        const data = snap.docs.map((doc) => ({ ...doc.data(), _docId: doc.id }));
        setPlaces(data);
        setFirebaseActive(true);
        setLoading(false);
      },
      (err) => { console.error("Firestore error:", err); setLoading(false); }
    );
    return unsub;
  }, [user]);

  // === SIGN IN / OUT ===
  const handleSignIn = () => {
    if (!FIREBASE_READY) { alert("Firebase not configured yet. See FIREBASE-SETUP-GUIDE.md"); return; }
    auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()).catch((e) => alert("Sign in failed: " + e.message));
  };
  const handleSignOut = () => { if (auth) auth.signOut(); };

  // === RADIUS FILTER HANDLERS ===
  const handleNearMe = () => {
    if (radiusMode === "nearMe") { clearRadius(); return; } // toggle off
    setGeoLoading(true);
    setGeoError("");
    navigator.geolocation.getCurrentPosition(
      (pos) => {
        setRadiusCenter({ lat: pos.coords.latitude, lng: pos.coords.longitude, label: "Your Location" });
        setRadiusMode("nearMe");
        setGeoLoading(false);
      },
      (err) => {
        setGeoError("Location access denied. Try the address search instead.");
        setGeoLoading(false);
      },
      { enableHighAccuracy: true, timeout: 10000 }
    );
  };

  const clearRadius = () => {
    setRadiusMode(null);
    setRadiusCenter(null);
    setRadiusMiles(5);
    setGeoError("");
  };

  // Set up Google Places Autocomplete for address search
  useEffect(() => {
    if (!window.google || !window.google.maps || !window.google.maps.places || !addressInputRef.current) return;
    if (addressAcRef.current) return;

    const tryInit = () => {
      if (!window.google || !window.google.maps || !window.google.maps.places || !addressInputRef.current) return false;
      const ac = new google.maps.places.Autocomplete(addressInputRef.current, {
        componentRestrictions: { country: "us" },
        fields: ["formatted_address", "geometry", "name"]
      });
      ac.addListener("place_changed", () => {
        const p = ac.getPlace();
        if (!p || !p.geometry) return;
        setRadiusCenter({
          lat: p.geometry.location.lat(),
          lng: p.geometry.location.lng(),
          label: p.formatted_address || "Selected Address"
        });
        setRadiusMode("address");
        setGeoError("");
      });
      addressAcRef.current = ac;
      return true;
    };

    if (!tryInit()) {
      let attempts = 0;
      const interval = setInterval(() => {
        attempts++;
        if (tryInit() || attempts >= 20) clearInterval(interval);
      }, 500);
      return () => clearInterval(interval);
    }
  }, [radiusMode]);

  // === DATA MIGRATION ===
  const handleMigrate = async () => {
    if (!user || !db) return;
    setMigrating(true);
    setMigrateStatus("Uploading restaurants...");
    try {
      const batch_size = 20;
      for (let i = 0; i < PLACES.length; i += batch_size) {
        const batch = db.batch();
        PLACES.slice(i, i + batch_size).forEach((p) => {
          const doc = db.collection("restaurants").doc();
          batch.set(doc, { ...p, createdBy: user.email, createdAt: firebase.firestore.FieldValue.serverTimestamp() });
        });
        await batch.commit();
        setMigrateStatus(`Uploaded ${Math.min(i + batch_size, PLACES.length)} of ${PLACES.length}...`);
      }
      setMigrateStatus("Done! " + PLACES.length + " restaurants uploaded.");
      setMigrating(false);
    } catch (e) {
      setMigrateStatus("Error: " + e.message);
      setMigrating(false);
    }
  };

  // === GEOCODE BACKFILL ===
  const [geocoding, setGeocoding] = useState(false);
  const [geocodeProgress, setGeocodeProgress] = useState("");

  const handleGeocodeAll = async () => {
    if (!user || !db || !window.google || !window.google.maps || !window.google.maps.places) {
      alert("Sign in and make sure Google Maps is loaded first.");
      return;
    }

    // Find restaurants needing coordinates OR missing googlePlaceId
    let needsWork = places.filter((p) => !p.lat || !p.lng || !p.googlePlaceId);
    if (needsWork.length === 0) {
      // Re-check all places (useful if placeIds weren't saved previously)
      if (!confirm("All places appear to have data. Re-check all " + places.length + " places? This may take a few minutes.")) return;
      needsWork = places.filter((p) => p._docId);
    }

    setGeocoding(true);
    setGeocodeProgress("Starting...");

    // Create a hidden div for PlacesService (required by Google API)
    let serviceDiv = document.getElementById("places-service-div");
    if (!serviceDiv) {
      serviceDiv = document.createElement("div");
      serviceDiv.id = "places-service-div";
      serviceDiv.style.display = "none";
      document.body.appendChild(serviceDiv);
    }
    const service = new google.maps.places.PlacesService(serviceDiv);

    let updated = 0;
    let failed = 0;

    for (let i = 0; i < needsWork.length; i++) {
      const p = needsWork[i];
      const query = p.name + ", " + (p.location || "Boulder") + ", Colorado";
      setGeocodeProgress("Looking up " + (i + 1) + " of " + needsWork.length + ": " + p.name);

      try {
        // Use findPlaceFromQuery to get placeId + location in one call
        const placeResult = await new Promise((resolve, reject) => {
          service.findPlaceFromQuery({
            query: query,
            fields: ["place_id", "geometry", "formatted_address", "name"]
          }, (results, status) => {
            if (status === "OK" && results && results[0]) resolve(results[0]);
            else reject(status);
          });
        });

        const updateData = {};
        if (placeResult.geometry && placeResult.geometry.location) {
          updateData.lat = placeResult.geometry.location.lat();
          updateData.lng = placeResult.geometry.location.lng();
        }
        if (placeResult.formatted_address) {
          updateData.address = placeResult.formatted_address;
        }
        if (placeResult.place_id) {
          updateData.googlePlaceId = placeResult.place_id;
        }

        if (p._docId && Object.keys(updateData).length > 0) {
          await db.collection("restaurants").doc(p._docId).update(updateData);
        }
        updated++;
      } catch (err) {
        console.warn("Failed to look up:", p.name, err);
        failed++;
      }

      // Small delay to avoid hitting API rate limits
      if (i < needsWork.length - 1) {
        await new Promise((r) => setTimeout(r, 300));
      }
    }

    setGeocodeProgress("Done! " + updated + " updated" + (failed > 0 ? ", " + failed + " failed" : ""));
    setGeocoding(false);
  };

  // === TAG MIGRATION ===
  const [tagging, setTagging] = useState(false);
  const [tagProgress, setTagProgress] = useState("");

  const handleTagMigration = async () => {
    if (!user || !db) { alert("Sign in first."); return; }
    setTagging(true);
    setTagProgress("Applying tags...");

    const KIDS_AND_BEERS_NAMES = [
      "Junkyard Social", "Avery", "Rayback Collective", "Acreage",
      "Rocky Flats Beergarden", "Colorado Tap House", "Grossen Bart",
      "New Terrain Brewing"
    ];
    const KIDS_AND_BEERS_PARTIAL = [
      { match: "Pica's", location: "Boulder" },
      { match: "Post", location: "Lafayette" },
    ];

    let updated = 0;
    for (const p of places) {
      if (!p._docId) continue;
      const updateData = {};

      // Date Night: tag if goodFor/vibe/notes contains "date"
      if (!p.dateNight) {
        const dateHint = ((p.goodFor || "") + " " + (p.vibe || "") + " " + (p.notes || "")).toLowerCase();
        if (dateHint.includes("date")) {
          updateData.dateNight = true;
        }
      }

      // Kids & Beers: tag by exact name or partial match with location
      if (!p.kidsAndBeers) {
        const isKB = KIDS_AND_BEERS_NAMES.some((n) => n.toLowerCase() === (p.name || "").toLowerCase()) ||
          KIDS_AND_BEERS_PARTIAL.some((m) => (p.name || "").toLowerCase().includes(m.match.toLowerCase()) && (p.location || "").toLowerCase() === m.location.toLowerCase());
        if (isKB) {
          updateData.kidsAndBeers = true;
        }
      }

      if (Object.keys(updateData).length > 0) {
        try {
          await db.collection("restaurants").doc(p._docId).update(updateData);
          updated++;
        } catch (e) {
          console.warn("Failed to tag:", p.name, e);
        }
      }
    }

    setTagging(false);
    if (updated > 0) {
      setTagProgress("Done! Tagged " + updated + " places.");
    } else {
      setTagProgress("No new tags to apply ‚Äî all places are already tagged.");
    }
    alert("Tag migration complete: " + updated + " places updated.");
  };

  // Check if migration is needed (any places missing the new fields)
  const needsTagMigration = places.some((p) => p.dateNight === undefined || p.kidsAndBeers === undefined);

  // === LOCATION CONSOLIDATION MIGRATION ===
  const BOULDER_LOCATIONS = ["Central Boulder", "Downtown", "East Boulder", "North Boulder", "South Boulder", "The Hill"];
  const needsLocationMigration = places.some((p) => BOULDER_LOCATIONS.includes(p.location));

  const handleLocationMigration = async () => {
    if (!user || !db) { alert("Sign in first."); return; }
    const toUpdate = places.filter((p) => BOULDER_LOCATIONS.includes(p.location) && p._docId);
    if (toUpdate.length === 0) return;

    let updated = 0;
    for (const p of toUpdate) {
      try {
        await db.collection("restaurants").doc(p._docId).update({ location: "Boulder" });
        updated++;
      } catch (e) {
        console.warn("Failed to update location:", p.name, e);
      }
    }
    alert("Updated " + updated + " places to 'Boulder' location.");
  };

  // === GOOGLE NEARBY SEARCH ===
  const searchNearby = useCallback(async () => {
    if (!radiusCenter || !window.google || !window.google.maps || !window.google.maps.places) return;
    setNearbyLoading(true);

    let serviceDiv = document.getElementById("places-service-div");
    if (!serviceDiv) {
      serviceDiv = document.createElement("div");
      serviceDiv.id = "places-service-div";
      serviceDiv.style.display = "none";
      document.body.appendChild(serviceDiv);
    }
    const service = new google.maps.places.PlacesService(serviceDiv);

    try {
      const results = await new Promise((resolve, reject) => {
        service.nearbySearch({
          location: { lat: radiusCenter.lat, lng: radiusCenter.lng },
          radius: radiusMiles * 1609.34, // convert miles to meters
          type: "restaurant"
        }, (results, status) => {
          if (status === "OK" && results) resolve(results);
          else if (status === "ZERO_RESULTS") resolve([]);
          else reject(status);
        });
      });

      // Filter out places already in our list (by name similarity)
      const existingNames = new Set(places.map((p) => p.name.toLowerCase().trim()));
      const filtered = results.filter((r) => {
        const rName = (r.name || "").toLowerCase().trim();
        // Skip if we already have this place (exact or very close match)
        return !existingNames.has(rName) && ![...existingNames].some((n) => rName.includes(n) || n.includes(rName));
      });

      setNearbyResults(filtered);
    } catch (err) {
      console.warn("Nearby search failed:", err);
      setNearbyResults([]);
    }
    setNearbyLoading(false);
  }, [radiusCenter, radiusMiles, places]);

  // Clear nearby results when radius is cleared
  useEffect(() => {
    if (!radiusMode) {
      setNearbyResults([]);
      setNearbyShown(false);
    }
  }, [radiusMode]);

  // Quick-add a Google nearby result to your list
  const addFromGoogle = async (googlePlace) => {
    if (!user || !db) { alert("Sign in first to add places."); return; }
    const newPlace = {
      name: googlePlace.name || "",
      location: "Boulder",
      type: "Restaurant",
      foodType: "",
      kidFriendly: "",
      vibe: "",
      goodFor: "",
      happyHour: false, dinner: false, lunch: false, brunch: false,
      outdoor: false, notableOutdoor: false,
      dateNight: false, kidsAndBeers: false,
      notes: "",
      address: googlePlace.vicinity || "",
      googlePlaceId: googlePlace.place_id || "",
      phone: "",
      website: "",
      lat: googlePlace.geometry ? googlePlace.geometry.location.lat() : null,
      lng: googlePlace.geometry ? googlePlace.geometry.location.lng() : null,
    };
    // Open the edit form pre-filled so user can customize before saving
    setEditingPlace(newPlace);
    setExpandedId(null);
    // Scroll to top to see the form
    window.scrollTo({ top: 0, behavior: "smooth" });
  };

  // === OPEN NOW LOGIC ===
  const checkOpenNow = useCallback(async () => {
    if (!window.google || !window.google.maps || !window.google.maps.places) return;

    // Auto-checking hours in background...

    // Create hidden div for PlacesService
    let serviceDiv = document.getElementById("places-service-div");
    if (!serviceDiv) {
      serviceDiv = document.createElement("div");
      serviceDiv.id = "places-service-div";
      serviceDiv.style.display = "none";
      document.body.appendChild(serviceDiv);
    }
    const service = new google.maps.places.PlacesService(serviceDiv);

    // Only check places that have a googlePlaceId and aren't cached (or cache expired)
    const now = Date.now();
    const CACHE_DURATION = 15 * 60 * 1000; // 15 minutes
    const placesToCheck = places.filter((p) => {
      if (!p.googlePlaceId) return false;
      const cached = openNowCache[p.googlePlaceId];
      if (cached && (now - cached.checkedAt) < CACHE_DURATION) return false;
      return true;
    });

    const newCache = { ...openNowCache };

    // Check in batches with delays to avoid rate limits
    for (let i = 0; i < placesToCheck.length; i++) {
      const p = placesToCheck[i];
      try {
        const details = await new Promise((resolve, reject) => {
          service.getDetails({
            placeId: p.googlePlaceId,
            fields: ["opening_hours", "business_status"]
          }, (result, status) => {
            if (status === "OK" && result) resolve(result);
            else reject(status);
          });
        });

        let isOpen = null; // null = unknown
        if (details.business_status === "CLOSED_TEMPORARILY" || details.business_status === "CLOSED_PERMANENTLY") {
          isOpen = false;
        } else if (details.opening_hours && typeof details.opening_hours.isOpen === "function") {
          isOpen = details.opening_hours.isOpen();
        }

        newCache[p.googlePlaceId] = { isOpen, checkedAt: Date.now() };
      } catch (err) {
        // If we can't check, mark as unknown
        newCache[p.googlePlaceId] = { isOpen: null, checkedAt: Date.now() };
      }

      // Small delay between API calls
      if (i < placesToCheck.length - 1) {
        await new Promise((r) => setTimeout(r, 150));
      }
    }

    setOpenNowCache(newCache);
    setOpenNowChecked(true);

  }, [places, openNowCache]);

  // Auto-check hours when Google is ready and places are loaded
  useEffect(() => {
    if (!openNowChecked && places.length > 0 && places.some((p) => p.googlePlaceId) && window.google && window.google.maps && window.google.maps.places) {
      checkOpenNow();
    }
  }, [places, openNowChecked, checkOpenNow]);

  // Retry checking once Google Maps loads (it loads async)
  useEffect(() => {
    if (openNowChecked || !window.GOOGLE_MAPS_READY) return;
    const interval = setInterval(() => {
      if (window.google && window.google.maps && window.google.maps.places) {
        clearInterval(interval);
        if (!openNowChecked && places.some((p) => p.googlePlaceId)) {
          checkOpenNow();
        }
      }
    }, 2000);
    return () => clearInterval(interval);
  }, [places.length, openNowChecked]);

  // === CRUD OPERATIONS ===
  const savePlace = async (formData) => {
    if (!user || !db) return;
    try {
      if (formData._docId) {
        // Update existing
        const { _docId, ...data } = formData;
        await db.collection("restaurants").doc(_docId).update({ ...data, updatedAt: firebase.firestore.FieldValue.serverTimestamp() });
      } else {
        // Add new
        const nextId = Math.max(...places.map((p) => p.id || 0), 0) + 1;
        await db.collection("restaurants").add({
          ...formData, id: nextId,
          createdBy: user.email, createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
      }
      setEditingPlace(null);
      setExpandedId(null);
    } catch (e) { alert("Save failed: " + e.message); }
  };

  const deletePlace = async (place) => {
    if (!user || !db || !place._docId) return;
    try {
      await db.collection("restaurants").doc(place._docId).delete();
      setExpandedId(null);
    } catch (e) { alert("Delete failed: " + e.message); }
  };

  // === EXPORT TO SPREADSHEET ===
  const handleExport = () => {
    const headers = ["Name", "Location", "Type", "Food Type", "Kid Friendly", "Vibe", "Good For", "Happy Hour", "Dinner", "Lunch", "Breakfast/Brunch", "Has Outdoor Space", "Notable Outdoor Space", "Date Night", "Kids & Beers", "Notes", "Address", "Phone", "Website"];
    const rows = places.map((p) => [
      p.name || "", p.location || "", p.type || "", p.foodType || "",
      p.kidFriendly === "yes" ? "Y" : p.kidFriendly === "maybe" ? "Maybe" : p.kidFriendly === "no" ? "N" : "",
      p.vibe || "", p.goodFor || "",
      p.happyHour ? "Y" : "N", p.dinner ? "Y" : "N", p.lunch ? "Y" : "N", p.brunch ? "Y" : "N",
      p.outdoor ? "Y" : "N", p.notableOutdoor ? "Y" : "N",
      p.dateNight ? "Y" : "N", p.kidsAndBeers ? "Y" : "N",
      p.notes || "", p.address || "", p.phone || "", p.website || ""
    ]);
    const ws = XLSX.utils.aoa_to_sheet([headers, ...rows]);
    ws["!cols"] = [{ wch: 30 }, { wch: 16 }, { wch: 20 }, { wch: 16 }, { wch: 12 }, { wch: 40 }, { wch: 30 }, { wch: 10 }, { wch: 8 }, { wch: 8 }, { wch: 14 }, { wch: 14 }, { wch: 16 }, { wch: 12 }, { wch: 12 }, { wch: 50 }, { wch: 40 }, { wch: 16 }, { wch: 30 }];
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "Restaurants");
    const today = new Date().toISOString().split("T")[0];
    XLSX.writeFile(wb, "Spot-Finder-Export-" + today + ".xlsx");
  };

  const locations = useMemo(() => [...new Set(places.map((p) => p.location).filter(Boolean))].sort(), [places]);
  const types = useMemo(() => [...new Set(places.map((p) => p.type).filter(Boolean))].sort(), [places]);
  const foodTypes = useMemo(() => [...new Set(places.map((p) => p.foodType).filter(Boolean))].sort(), [places]);

  const filtered = useMemo(() => {
    let result = places.filter((p) => {
      if (search) {
        const q = search.toLowerCase();
        const searchable = `${p.name} ${p.foodType} ${p.vibe} ${p.notes} ${p.goodFor}`.toLowerCase();
        if (!searchable.includes(q)) return false;
      }
      if (filterLocations.length > 0 && !filterLocations.includes(p.location)) return false;
      if (filterTypes.length > 0 && !filterTypes.includes(p.type)) return false;
      if (filterFoodTypes.length > 0 && !filterFoodTypes.includes(p.foodType)) return false;
      if (filterKidFriendly && p.kidFriendly !== "yes" && p.kidFriendly !== "maybe") return false;
      if (filterHappyHour && !p.happyHour) return false;
      if (filterOutdoor && !p.outdoor) return false;
      if (filterDinner && !p.dinner) return false;
      if (filterLunch && !p.lunch) return false;
      if (filterBrunch && !p.brunch) return false;
      if (filterDateNight && !p.dateNight) return false;
      if (filterKidsAndBeers && !p.kidsAndBeers) return false;

      // Radius filter: skip places without coordinates
      if (radiusMode && radiusCenter) {
        if (!p.lat || !p.lng) return false;
        const dist = haversine(radiusCenter.lat, radiusCenter.lng, p.lat, p.lng);
        if (dist > radiusMiles) return false;
      }
      return true;
    });

    // Sort by distance when radius is active, otherwise alphabetical
    if (radiusMode && radiusCenter) {
      result.sort((a, b) => {
        const dA = (a.lat && a.lng) ? haversine(radiusCenter.lat, radiusCenter.lng, a.lat, a.lng) : 999;
        const dB = (b.lat && b.lng) ? haversine(radiusCenter.lat, radiusCenter.lng, b.lat, b.lng) : 999;
        return dA - dB;
      });
    } else {
      result.sort((a, b) => a.name.localeCompare(b.name));
    }

    return result;
  }, [places, search, filterLocations, filterTypes, filterFoodTypes, filterKidFriendly, filterHappyHour, filterOutdoor, filterDinner, filterLunch, filterBrunch, filterDateNight, filterKidsAndBeers, radiusMode, radiusCenter, radiusMiles]);

  const hasActiveFilters = search || filterLocations.length > 0 || filterTypes.length > 0 || filterFoodTypes.length > 0 || filterKidFriendly || filterHappyHour || filterOutdoor || filterDinner || filterLunch || filterBrunch || filterDateNight || filterKidsAndBeers || radiusMode;

  const clearFilters = () => {
    setSearch(""); setFilterLocations([]); setFilterTypes([]); setFilterFoodTypes([]);
    setFilterKidFriendly(false); setFilterHappyHour(false); setFilterOutdoor(false);
    setFilterDinner(false); setFilterLunch(false); setFilterBrunch(false);
    setFilterDateNight(false); setFilterKidsAndBeers(false); clearRadius();
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-amber-50">
      {/* Header */}
      <div className="bg-white/80 border-b border-purple-100 sticky top-0 z-10" style={{ backdropFilter: "blur(12px)" }}>
        <div className="max-w-2xl mx-auto px-4 py-3">
          {/* Row 0: Title + Auth + Add */}
          <div className="flex items-center justify-between mb-2">
            <h1 className="text-lg font-black bg-gradient-to-r from-purple-600 via-pink-500 to-amber-500 bg-clip-text" style={{ WebkitBackgroundClip: "text", WebkitTextFillColor: "transparent" }}>
              Spot Finder
            </h1>
            <div className="flex items-center gap-2">
              {FIREBASE_READY && !user && (
                <button onClick={handleSignIn} className="text-xs font-bold text-purple-500 hover:text-purple-700 px-2 py-1">
                  Sign in
                </button>
              )}
              {user && (
                <>
                  <span className="text-xs text-gray-400 hidden sm:inline">{user.email}</span>
                  <button onClick={handleSignOut} className="text-xs text-gray-400 hover:text-gray-600 px-1">
                    Sign out
                  </button>
                </>
              )}
              {user && (
                <button
                  onClick={() => { setEditingPlace({ name: "", location: "", type: "", foodType: "", kidFriendly: "", vibe: "", goodFor: "", happyHour: false, dinner: false, lunch: false, brunch: false, outdoor: false, notableOutdoor: false, dateNight: false, kidsAndBeers: false, notes: "", address: "", googlePlaceId: "", phone: "", website: "", lat: null, lng: null }); setExpandedId(null); }}
                  className="bg-gradient-to-r from-purple-600 to-pink-500 text-white text-xs font-bold px-3.5 py-1.5 rounded-full shadow-md hover:shadow-lg transition-all shrink-0"
                >
                  + Add
                </button>
              )}
              {!user && (
                <span className="text-xs text-gray-300 italic">{FIREBASE_READY ? "" : ""}</span>
              )}
            </div>
          </div>

          {/* Row 1: Search */}
          <div className="mb-2">
            <input
              type="text"
              placeholder="Search..."
              value={search}
              onChange={(e) => setSearch(e.target.value)}
              className="w-full border-2 border-purple-100 rounded-xl px-3 py-1.5 text-sm font-medium focus:outline-none focus:ring-2 focus:ring-purple-300 focus:border-transparent bg-white"
            />
          </div>

          {/* Row 2: Dropdowns + emoji toggles */}
          <div className="flex gap-1.5 items-center mb-2">
            <MultiSelect label="Type" allLabel="All Types" options={types} selected={filterTypes} onChange={setFilterTypes} />
            <MultiSelect label="Location" allLabel="All Locations" options={locations} selected={filterLocations} onChange={setFilterLocations} />
            <MultiSelect label="Food" allLabel="All Food Types" options={foodTypes} selected={filterFoodTypes} onChange={setFilterFoodTypes} />
            <Toggle label="üë∂" active={filterKidFriendly} onClick={() => setFilterKidFriendly(!filterKidFriendly)} color="green" />
            <Toggle label="üå≥" active={filterOutdoor} onClick={() => setFilterOutdoor(!filterOutdoor)} color="teal" />
            <Toggle label="üç∑" active={filterDateNight} onClick={() => setFilterDateNight(!filterDateNight)} color="rose" />
          </div>

          {/* Row 3: Meal toggles + special filters */}
          <div className="flex items-center gap-1.5 flex-wrap">
            <Toggle label="Brunch" active={filterBrunch} onClick={() => setFilterBrunch(!filterBrunch)} color="rose" />
            <Toggle label="Lunch" active={filterLunch} onClick={() => setFilterLunch(!filterLunch)} color="purple" />
            <Toggle label="Dinner" active={filterDinner} onClick={() => setFilterDinner(!filterDinner)} color="purple" />
            <Toggle label="Happy Hour" active={filterHappyHour} onClick={() => setFilterHappyHour(!filterHappyHour)} color="amber" />
            <Toggle label="Kids & Beers" active={filterKidsAndBeers} onClick={() => setFilterKidsAndBeers(!filterKidsAndBeers)} color="blue" />
            {hasActiveFilters && (
              <button onClick={clearFilters} className="text-xs font-bold text-purple-500 hover:text-purple-700 ml-1">
                Clear
              </button>
            )}
          </div>

          {/* Row 4: Radius Filter */}
          <div className="mt-2 pt-2 border-t border-purple-50">
            <div className="flex items-center gap-2 flex-wrap">
              <button
                onClick={handleNearMe}
                disabled={geoLoading}
                className={`text-xs font-semibold px-3.5 py-1.5 rounded-full transition-all ${
                  radiusMode === "nearMe"
                    ? "bg-blue-600 text-white shadow-lg shadow-blue-200"
                    : "bg-white text-gray-700 hover:bg-gray-50 border border-gray-300 shadow-sm"
                }`}
              >
                {geoLoading ? "Finding you..." : "Near Me"}
              </button>
              <div className="flex-1 min-w-[140px]">
                <input
                  ref={addressInputRef}
                  placeholder="Search near an address..."
                  className={`w-full border-2 rounded-xl px-3 py-1.5 text-sm font-medium focus:outline-none focus:ring-2 focus:ring-blue-300 focus:border-transparent ${
                    radiusMode === "address" ? "border-blue-300 bg-blue-50" : "border-purple-100 bg-white"
                  }`}
                />
              </div>
              {radiusMode && (
                <>
                  <div className="flex items-center gap-1.5">
                    <input
                      type="range"
                      min="1"
                      max="10"
                      step="0.5"
                      value={radiusMiles}
                      onChange={(e) => setRadiusMiles(parseFloat(e.target.value))}
                      className="w-20 accent-blue-600"
                    />
                    <span className="text-xs font-bold text-blue-600 w-10">{radiusMiles} mi</span>
                  </div>
                  <button onClick={clearRadius} className="text-xs font-bold text-blue-500 hover:text-blue-700">
                    Clear
                  </button>
                </>
              )}
            </div>
            {geoError && <p className="text-xs text-red-400 mt-1">{geoError}</p>}
            {radiusMode && radiusCenter && (
              <p className="text-xs text-blue-400 mt-1">Showing places within {radiusMiles} mi of {radiusCenter.label}</p>
            )}
          </div>
        </div>
      </div>

      {/* List */}
      <div className="max-w-2xl mx-auto px-4 py-2 space-y-1">
        {/* Loading state */}
        {loading && (
          <div className="text-center py-16">
            <p className="text-lg font-bold text-purple-300">Loading restaurants...</p>
          </div>
        )}

        {/* Migration prompt ‚Äî shows when Firebase is active but no data exists */}
        {!loading && firebaseActive && places.length === 0 && (
          <div className="text-center py-12 space-y-4">
            <p className="text-lg font-bold text-purple-400">No restaurants in database yet</p>
            <p className="text-sm text-gray-400">Click below to upload all {PLACES.length} restaurants from the built-in list.</p>
            <button
              onClick={handleMigrate}
              disabled={migrating}
              className="bg-gradient-to-r from-purple-600 to-pink-500 text-white text-sm font-bold px-6 py-3 rounded-xl shadow-md hover:shadow-lg transition-all disabled:opacity-50"
            >
              {migrating ? migrateStatus : "Migrate " + PLACES.length + " Restaurants to Firebase"}
            </button>
            {migrateStatus && <p className="text-xs text-gray-400">{migrateStatus}</p>}
          </div>
        )}

        {/* Edit/Add form */}
        {editingPlace && (
          <div className="mb-2">
            <EditForm
              place={editingPlace}
              onSave={savePlace}
              onCancel={() => setEditingPlace(null)}
              locations={locations}
              types={types}
              foodTypes={foodTypes}
              existingPlaces={places}
            />
          </div>
        )}

        {/* Restaurant list */}
        {!loading && filtered.length === 0 && places.length > 0 ? (
          <div className="text-center py-16">
            <p className="text-lg font-bold text-purple-300">No spots match</p>
            <button onClick={clearFilters} className="text-purple-500 text-sm mt-2 font-bold hover:underline">Clear filters</button>
          </div>
        ) : (
          filtered.map((place) => (
            <PlaceRow
              key={place._docId || place.id}
              place={place}
              isExpanded={expandedId === (place._docId || place.id)}
              onToggle={() => setExpandedId(expandedId === (place._docId || place.id) ? null : (place._docId || place.id))}
              user={user}
              onEdit={(p) => { setEditingPlace(p); setExpandedId(null); }}
              onDelete={deletePlace}
              radiusMode={radiusMode}
              radiusCenter={radiusCenter}
              openStatus={place.googlePlaceId && openNowCache[place.googlePlaceId] ? openNowCache[place.googlePlaceId].isOpen : null}
            />
          ))
        )}

        {/* Google Nearby Results */}
        {radiusMode && radiusCenter && window.GOOGLE_MAPS_READY && (
          <div className="mt-3">
            {!nearbyShown ? (
              <button
                onClick={() => { setNearbyShown(true); searchNearby(); }}
                className="w-full py-2.5 text-xs font-bold text-blue-500 hover:text-blue-700 bg-blue-50 hover:bg-blue-100 rounded-xl transition-all"
              >
                Show more from Google Maps nearby
              </button>
            ) : nearbyLoading ? (
              <p className="text-center text-xs text-blue-400 py-3">Searching nearby...</p>
            ) : nearbyResults.length > 0 ? (
              <div className="space-y-1">
                <p className="text-xs font-bold text-blue-400 px-1 pt-1">Other nearby places from Google</p>
                {nearbyResults.map((r) => (
                  <div key={r.place_id} className="flex items-center gap-2 bg-blue-50/50 rounded-xl px-3 py-2 border border-blue-100">
                    <div className="flex-1 min-w-0">
                      <p className="text-sm font-medium text-blue-800 truncate">{r.name}</p>
                      <p className="text-xs text-blue-400 truncate">{r.vicinity}</p>
                      {r.rating && <span className="text-xs text-amber-500">{"‚òÖ".repeat(Math.round(r.rating))} {r.rating}</span>}
                    </div>
                    {r.geometry && r.geometry.location && (
                      <span className="text-[10px] font-bold text-blue-400 bg-blue-100 px-2 py-0.5 rounded-full shrink-0">
                        {haversine(radiusCenter.lat, radiusCenter.lng, r.geometry.location.lat(), r.geometry.location.lng()).toFixed(1)} mi
                      </span>
                    )}
                    {user && (
                      <button
                        onClick={() => addFromGoogle(r)}
                        className="text-xs font-bold text-blue-500 hover:text-blue-700 bg-white px-2.5 py-1 rounded-full border border-blue-200 hover:border-blue-400 shrink-0 transition-all"
                      >
                        + Add
                      </button>
                    )}
                  </div>
                ))}
              </div>
            ) : (
              <p className="text-center text-xs text-gray-400 py-2">No additional places found nearby</p>
            )}
          </div>
        )}

        {/* Spot count + Export */}
        {!loading && places.length > 0 && (
          <div className="text-center py-4 space-y-1">
            <span className="text-xs text-gray-300">{filtered.length} of {places.length} spots</span>
            {!FIREBASE_READY && <span className="text-xs text-gray-300 ml-2">&middot; offline mode</span>}
            <div className="flex items-center justify-center gap-3">
              <button onClick={handleExport} className="text-xs text-purple-400 hover:text-purple-600 font-medium hover:underline">
                Export to Spreadsheet
              </button>
              {user && needsLocationMigration && (
                <button onClick={handleLocationMigration} className="text-xs text-orange-400 hover:text-orange-600 font-medium hover:underline">
                  Consolidate Boulder Locations ({places.filter((p) => BOULDER_LOCATIONS.includes(p.location)).length} to update)
                </button>
              )}
              {user && needsTagMigration && (
                <button onClick={handleTagMigration} disabled={tagging} className="text-xs text-rose-400 hover:text-rose-600 font-medium hover:underline disabled:opacity-50">
                  {tagging ? tagProgress : "Apply Date Night & Kids Tags"}
                </button>
              )}
              {user && window.GOOGLE_MAPS_READY && (
                <button onClick={handleGeocodeAll} disabled={geocoding} className="text-xs text-blue-400 hover:text-blue-600 font-medium hover:underline disabled:opacity-50">
                  {geocoding ? geocodeProgress : (() => {
                    const missing = places.filter((p) => !p.lat || !p.lng || !p.googlePlaceId);
                    return missing.length > 0 ? "Add Coordinates & IDs (" + missing.length + " need updating)" : "Re-check All Coordinates & IDs";
                  })()}
                </button>
              )}
            </div>
          </div>
        )}
      </div>
    </div>
  );
}

const root = ReactDOM.createRoot(document.getElementById("root"));
root.render(<SpotFinder />);
  </script>
</body>
</html>
